import{u as e,r as s,j as a}from"./vendor.Ml7xHclh.js";import{_ as t,a as r}from"./ai-vendor.DHCHU3XM.js";import{c as i}from"./utils.Ceoo1Swf.js";import{B as o,a as l,L as n,D as d,T as c,b as g,P as u,C as x}from"./lucide-icons.CJY1ueNI.js";t.allowLocalModels=!1,t.useBrowserCache=!0;const m=[{id:"Xenova/LaMini-Flan-T5-248M",name:"Standard (248M)",description:"Balanced performance & quality (~900MB)",size:"900MB",file:"config.json"},{id:"Xenova/LaMini-Flan-T5-77M",name:"Lite (77M)",description:"Fastest, lower quality (~300MB)",size:"300MB",file:"config.json"}];function p(){const{t:t}=e(),[p,h]=s.useState(""),[y,f]=s.useState("College"),[w,b]=s.useState("Medium (500 words)"),[j,v]=s.useState(""),[_,N]=s.useState(!1),[M,S]=s.useState(m[0].id),C=m.find(e=>e.id===M)||m[0],[$,F]=s.useState("idle"),[L,k]=s.useState(null),[D,B]=s.useState(null),[z,P]=s.useState(""),R=s.useRef(null);s.useEffect(()=>{(async()=>{try{if("caches"in window){const e=await caches.open("transformers-cache"),s=`https://huggingface.co/${m[0].id}/resolve/main/${m[0].file}`;if(await e.match(s))return S(m[0].id),void I(m[0].id);const a=`https://huggingface.co/${m[1].id}/resolve/main/${m[1].file}`;if(await e.match(a))return S(m[1].id),void I(m[1].id)}}catch(e){}})()},[]);const T=e=>{const s=(e||"").trim();return!!s&&(/^sorry[, ]/i.test(s)||/i (can('|â€™)t|cannot) (help|complete|do)/i.test(s)||/goes against (the )?policy/i.test(s)||/not allowed/i.test(s)||/as an ai/i.test(s))},E=e=>e?e.replace(/^\s*###\s*Response:\s*/i,"").replace(/^\s*Response:\s*/i,"").trim():"",I=async(e=M)=>{if(R.current&&L===e)F("ready");else try{F("loading"),P("");const s=await r("text2text-generation",e,{progress_callback:e=>{try{"initiate"===e.status?B({status:`Downloading ${e.file}...`,progress:0}):"progress"===e.status?B({status:`Downloading ${e.file}...`,progress:e.progress}):"done"===e.status?B({status:"Model loaded!",progress:100}):e.status}catch{}}});R.current=s,k(e),F("ready"),B(null)}catch(s){F("error"),P(s.message||"Failed to load the model."),k(null)}},W="ready"===$&&L===M;return a.jsxs("div",{className:"grid lg:grid-cols-2 gap-8",children:[a.jsx("div",{className:"space-y-6",children:a.jsxs("div",{className:"p-6 rounded-2xl bg-gray-50 border border-gray-200 space-y-6 shadow-sm",children:[a.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-3",children:[a.jsxs("h3",{className:"font-bold text-gray-900 flex items-center gap-2",children:[a.jsx(o,{className:"w-5 h-5 text-indigo-600"}),t("tools_ui.ai_essay_writer.title")]}),a.jsxs("div",{className:i("text-xs font-medium px-2 py-1 rounded-full border flex items-center gap-1.5 transition-colors",W?"bg-green-50 text-green-700 border-green-200":"loading"===$?"bg-yellow-50 text-yellow-700 border-yellow-200":"bg-gray-100 text-gray-700 border-gray-200"),children:[W&&a.jsx(l,{className:"w-3 h-3"}),"loading"===$&&a.jsx(n,{className:"w-3 h-3 animate-spin"}),W?`${C.name} Ready`:"loading"===$?"Downloading...":"Offline Model"]})]}),"loading"===$&&D&&a.jsxs("div",{className:"p-4 bg-indigo-50 border border-indigo-100 rounded-xl space-y-2 animate-pulse",children:[a.jsxs("div",{className:"flex items-center gap-2 text-indigo-800 text-sm font-medium",children:[a.jsx(d,{className:"w-4 h-4"}),D.status]}),a.jsx("div",{className:"w-full bg-indigo-200 rounded-full h-2",children:a.jsx("div",{className:"bg-indigo-600 h-2 rounded-full transition-all duration-300",style:{width:`${Math.max(5,D.progress||0)}%`}})}),a.jsxs("p",{className:"text-xs text-indigo-600",children:["Downloading ",C.name," (",C.size,"). First run only."]})]}),"error"===$&&a.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-xl text-sm text-red-800",children:[a.jsxs("div",{className:"flex gap-2 mb-2 font-bold items-center",children:[a.jsx(c,{className:"w-4 h-4"})," Load Error"]}),a.jsx("p",{children:z}),a.jsx("button",{onClick:()=>{F("idle"),I()},className:"mt-3 underline font-medium",children:"Retry Download"})]}),a.jsxs("div",{className:"space-y-5",children:[a.jsxs("div",{className:"p-3 bg-white border border-gray-200 rounded-xl flex flex-col gap-2",children:[a.jsxs("label",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider flex items-center gap-1",children:[a.jsx(g,{className:"w-3 h-3"})," AI Model"]}),a.jsx("select",{value:M,onChange:e=>{const s=e.target.value;S(s),L!==s?(F("idle"),k(null)):F("ready")},className:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm text-gray-900 focus:outline-none focus:ring-2 focus:ring-indigo-500 cursor-pointer disabled:opacity-50",disabled:_||"loading"===$,children:m.map(e=>a.jsxs("option",{value:e.id,children:[e.name," - ",e.description]},e.id))})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700",children:t("tools_ui.ai_essay_writer.essay_topic_label")}),a.jsx("textarea",{value:p,onChange:e=>h(e.target.value),placeholder:t("tools_ui.ai_essay_writer.topic_placeholder"),rows:3,className:"w-full bg-white border border-gray-200 rounded-xl px-4 py-3 text-gray-900 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all resize-none shadow-sm placeholder:text-gray-400"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700",children:t("tools_ui.ai_essay_writer.level_label")}),a.jsx("div",{className:"relative",children:a.jsxs("select",{value:y,onChange:e=>f(e.target.value),className:"w-full bg-white border border-gray-200 rounded-lg px-4 py-2.5 text-gray-900 focus:outline-none focus:ring-2 focus:ring-indigo-500 appearance-none shadow-sm cursor-pointer",children:[a.jsx("option",{value:"High School",children:"High School"}),a.jsx("option",{value:"College",children:"College / undergrad"}),a.jsx("option",{value:"Graduate",children:"Graduate / PhD"}),a.jsx("option",{value:"Professional",children:"Professional"})]})})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700",children:t("tools_ui.ai_essay_writer.length_label")}),a.jsx("div",{className:"relative",children:a.jsxs("select",{value:w,onChange:e=>b(e.target.value),className:"w-full bg-white border border-gray-200 rounded-lg px-4 py-2.5 text-gray-900 focus:outline-none focus:ring-2 focus:ring-indigo-500 appearance-none shadow-sm cursor-pointer",children:[a.jsx("option",{value:"Short (300 words)",children:"Short (~300 words)"}),a.jsx("option",{value:"Medium (500 words)",children:"Medium (~500 words)"}),a.jsx("option",{value:"Long (800+ words)",children:"Long (800+ words)"})]})})]})]}),z&&"error"!==$&&a.jsx("div",{className:"p-3 bg-red-50 text-red-700 text-sm rounded-lg border border-red-100",children:z}),a.jsx("button",{onClick:async()=>{if(p&&(R.current&&L===M||(await I(M),R.current))){N(!0),v(""),P("");try{const e=p.replace(/^(write|create|make)\s+(an\s+)?essay\s+(about|on|regarding)\s+/i,"").trim(),s=await(async e=>{const s=((e,s,a)=>{const t=(e=>/short/i.test(e)?300:/long/i.test(e)?850:500)(a);return[`Write an essay about: ${e}.`,`Level: ${s}.`,`Length: about ${t} words.`,"Structure:","1) Introduction (1 paragraph)","2) Body (3-5 paragraphs with clear headings or topic sentences)","3) Conclusion (1 paragraph)","Style: clear, factual, and well-organized.","Do not mention policies, safety rules, or refusals. Just write the essay."].join("\n")})(e,y,w),a=await R.current(s,{max_new_tokens:900,do_sample:!0,temperature:.7,top_p:.92,repetition_penalty:1.12});let t=E(a?.[0]?.generated_text??"");if(t&&!T(t))return t;const r=`Write a well-structured essay about ${e}. Include an introduction, body, and conclusion.`,i=await R.current(r,{max_new_tokens:900,do_sample:!1,temperature:0,repetition_penalty:1.1});let o=E(i?.[0]?.generated_text??"");if(o&&!T(o))return o;const l=`Essay topic: ${e}\nWrite the essay now:`,n=await R.current(l,{max_new_tokens:900,do_sample:!1,temperature:0,repetition_penalty:1.08});return E(n?.[0]?.generated_text??"")})(e),a=E(s);if(!a)return void P("Failed to generate content. Please try again with a different topic.");v(a)}catch(e){P(e.message||"Failed to generate content.")}finally{N(!1)}}},disabled:_||W&&!p||"loading"===$,className:i("w-full py-4 rounded-xl font-bold transition-all shadow-lg flex items-center justify-center gap-2 transform active:scale-95 disabled:opacity-50 disabled:scale-100 disabled:cursor-not-allowed text-white",W?"bg-linear-to-r from-indigo-600 to-blue-600 hover:from-indigo-700 hover:to-blue-700 shadow-indigo-500/20":"bg-gray-800 hover:bg-gray-900 shadow-gray-500/20"),children:_?a.jsxs(a.Fragment,{children:[a.jsx(n,{className:"animate-spin w-5 h-5"})," ",t("tools_ui.ai_essay_writer.generating")]}):W?a.jsxs(a.Fragment,{children:[a.jsx(u,{className:"w-5 h-5"})," ",t("tools_ui.ai_essay_writer.generate_button")]}):a.jsxs(a.Fragment,{children:[a.jsx(d,{className:"w-5 h-5"})," Download ",C.name]})})]})]})}),a.jsx("div",{className:"h-full min-h-125 flex flex-col",children:j?a.jsxs("div",{className:"flex-1 bg-white border border-gray-200 rounded-2xl overflow-hidden flex flex-col animate-in fade-in shadow-sm",children:[a.jsxs("div",{className:"p-4 border-b border-gray-100 flex items-center justify-between bg-gray-50",children:[a.jsx("span",{className:"text-sm font-medium text-gray-500",children:t("tools_ui.ai_essay_writer.essay_draft")}),a.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(j)},className:"text-xs font-medium text-indigo-600 hover:text-indigo-700 flex items-center gap-1.5 transition-colors bg-indigo-50 px-3 py-1.5 rounded-full",children:[a.jsx(x,{className:"w-3.5 h-3.5"})," ",t("tools_ui.common.copy")]})]}),a.jsx("div",{className:"flex-1 p-8 overflow-y-auto custom-scrollbar bg-white",children:a.jsx("div",{className:"prose prose-gray max-w-none prose-headings:text-gray-900 prose-p:text-gray-600 prose-strong:text-gray-900 font-serif leading-relaxed",children:j.split("\n").map((e,s)=>a.jsx("p",{className:"mb-4",children:e},s))})})]}):a.jsx("div",{className:"flex-1 bg-gray-50 border-2 border-dashed border-gray-200 rounded-2xl flex items-center justify-center text-gray-400 p-8 text-center",children:a.jsxs("div",{children:[a.jsx(o,{className:"w-12 h-12 mx-auto mb-4 opacity-50 text-gray-300"}),a.jsx("p",{className:"font-medium text-gray-500",children:t("tools_ui.ai_essay_writer.essay_placeholder")}),a.jsx("p",{className:"text-xs text-gray-400 mt-2",children:t("tools_ui.ai_essay_writer.private_offline")})]})})})]})}export{p as default};
