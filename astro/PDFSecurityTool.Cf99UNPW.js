const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["astro/index.CDoH-x_i.js","astro/_commonjsHelpers.D6-XlEtG.js","astro/PDFButton.Bm7otZl6.js"])))=>i.map(i=>d[i]);
import{_ as E}from"./preload-helper.BlTxHScW.js";import{c as B,j as e}from"./createLucideIcon.CH-mSxXv.js";import{r}from"./index.BR1w_nJd.js";import{P as S}from"./PDFButton.Bm7otZl6.js";import{F as R}from"./fileUploader.BLbgfAQx.js";import{F as W}from"./FileSaver.min.D-v3scGK.js";import{L as _}from"./lock._1ZX4GeV.js";import{L}from"./lock-open.DVtepxpz.js";import{X as G}from"./x.PcIF29Xl.js";import{L as X}from"./loader-circle.D30OAAi7.js";import{D as Y}from"./download.DIzcI15b.js";import"./_commonjsHelpers.D6-XlEtG.js";import"./index.CeYlJSet.js";import"./utils.fNskMoFt.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],U=B("shield-alert",q);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],J=B("shield-check",H);function xe(){const[s,y]=r.useState("lock"),[o,i]=r.useState(null),[n,b]=r.useState(""),[k,j]=r.useState(!1),[h,l]=r.useState(null),[P,g]=r.useState(null),[u,v]=r.useState(!1),[M,N]=r.useState(0),T=a=>{a.length>0&&(i(a[0]),l(null),g(null),b(""),v(!1))},A=async()=>{if(!(!o||!n)){j(!0),g(null),N(0);try{const a=await o.arrayBuffer();if(s==="lock")try{const{encryptPDF:t}=await E(async()=>{const{encryptPDF:m}=await import("./index.CDoH-x_i.js");return{encryptPDF:m}},__vite__mapDeps([0,1,2])),d=await t(new Uint8Array(a),n,n);l(new Blob([d],{type:"application/pdf"}))}catch(t){throw t.message&&t.message.includes("Encrypted")?new Error("This PDF is already encrypted. Please unlock it first."):t}else if(u){const t=await E(()=>import("./pdf.OfKI3oAY.js"),[]);t.GlobalWorkerOptions.workerSrc="/pdf.worker.min.mjs";const m=await t.getDocument({data:new Uint8Array(a),password:n}).promise,F=m.numPages,f=await S.create();for(let p=1;p<=F;p++){const D=await m.getPage(p),w=D.getViewport({scale:5}),x=document.createElement("canvas"),C=x.getContext("2d");if(x.width=w.width,x.height=w.height,C){await D.render({canvasContext:C,viewport:w}).promise;const I=x.toDataURL("image/png"),O=await fetch(I).then(z=>z.arrayBuffer()),c=await f.embedPng(O);f.addPage([c.width,c.height]).drawImage(c,{x:0,y:0,width:c.width,height:c.height})}N(Math.round(p/F*100))}const V=await f.save();l(new Blob([V],{type:"application/pdf"}))}else try{const d=await(await S.load(a,{password:n,ignoreEncryption:!1})).save();l(new Blob([d],{type:"application/pdf"}))}catch(t){throw console.error("Unlock failed:",t),t.message&&t.message.toLowerCase().includes("password")?new Error("Incorrect password. Please try again."):t.message&&(t.message.includes("Unsupported")||t.message.includes("Encrypted"))?new Error("This PDF uses advanced encryption. Please try checking 'Force Unlock (Flatten PDF)' below."):new Error(`Unlock failed: ${t.message}`)}}catch(a){console.error("Security operation failed:",a),g(a.message||"Operation failed. Please try a different file.")}finally{j(!1)}}},$=()=>{if(h&&o){const a=s==="lock"?"protected":"unlocked";W.saveAs(h,`${a}-${o.name}`)}};return e.jsxs("div",{className:"max-w-4xl mx-auto space-y-8",children:[e.jsx("div",{className:"flex justify-center mb-8",children:e.jsxs("div",{className:"bg-white p-1 rounded-xl shadow-sm border border-gray-200 inline-flex",children:[e.jsxs("button",{onClick:()=>{y("lock"),i(null),l(null)},className:`px-6 py-2 rounded-lg text-sm font-semibold flex items-center gap-2 transition-all ${s==="lock"?"bg-red-50 text-red-600 shadow-sm":"text-gray-500 hover:text-gray-900"}`,children:[e.jsx(_,{className:"w-4 h-4"})," Lock PDF"]}),e.jsxs("button",{onClick:()=>{y("unlock"),i(null),l(null)},className:`px-6 py-2 rounded-lg text-sm font-semibold flex items-center gap-2 transition-all ${s==="unlock"?"bg-green-50 text-green-600 shadow-sm":"text-gray-500 hover:text-gray-900"}`,children:[e.jsx(L,{className:"w-4 h-4"})," Unlock PDF"]})]})}),o?e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-xl bg-gray-50 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s==="lock"?e.jsx(U,{className:"w-5 h-5 text-red-500"}):e.jsx(J,{className:"w-5 h-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 block",children:o.name}),e.jsxs("span",{className:"text-xs text-gray-400",children:["(",(o.size/1024/1024).toFixed(2)," MB)"]})]})]}),e.jsx("button",{onClick:()=>{i(null),l(null)},className:"p-1.5 hover:bg-gray-200 rounded-full text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(G,{className:"w-4 h-4"})})]}),h?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(K,{className:"w-8 h-8"})}),e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:s==="lock"?"File Protected!":"File Unlocked!"}),e.jsx("p",{className:"text-gray-500 mb-8",children:"Your file is ready for download."}),e.jsxs("button",{onClick:$,className:"px-8 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-bold shadow-lg shadow-blue-500/20 flex items-center gap-2 mx-auto transition-all",children:[e.jsx(Y,{className:"w-5 h-5"}),"Download ",s==="lock"?"Protected":"Unlocked"," PDF"]})]}):e.jsxs("div",{className:"max-w-md mx-auto space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s==="lock"?"Set Password":"Enter Password"}),e.jsx("input",{type:"password",value:n,onChange:a=>b(a.target.value),placeholder:s==="lock"?"Enter a strong password":"Enter the PDF password",className:"w-full px-4 py-3 rounded-lg border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all"}),P&&e.jsxs("div",{className:"text-red-500 text-sm mt-2 flex items-center gap-1",children:[e.jsx(U,{className:"w-3 h-3"})," ",P]})]}),s==="unlock"&&e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",id:"force-mode",checked:u,onChange:a=>v(a.target.checked),className:"mt-1 w-4 h-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500"}),e.jsxs("label",{htmlFor:"force-mode",className:"text-sm text-gray-700 cursor-pointer",children:[e.jsx("span",{className:"font-semibold block text-gray-900",children:"Force Unlock (Flatten PDF)"}),e.jsx("span",{className:"text-gray-500",children:"Enable this if regular unlocking fails (e.g. for Aadhaar or Bank Statements). Converts pages to images."})]})]}),e.jsx("button",{onClick:A,disabled:!n||k,className:`w-full py-3 rounded-xl font-bold text-lg shadow-lg flex items-center justify-center gap-2 transition-all disabled:opacity-70 disabled:cursor-not-allowed ${s==="lock"?"bg-red-600 hover:bg-red-700 shadow-red-500/20":"bg-green-600 hover:bg-green-700 shadow-green-500/20"} text-white`,children:k?e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"w-5 h-5 animate-spin"}),s==="lock"?"Encrypting...":u?`Processing (${M}%)...`:"Decrypting..."]}):e.jsxs(e.Fragment,{children:[s==="lock"?e.jsx(_,{className:"w-5 h-5"}):e.jsx(L,{className:"w-5 h-5"}),s==="lock"?"Protect PDF":"Unlock PDF"]})})]})]}):e.jsx(R,{onFilesSelected:T,accept:{"application/pdf":[".pdf"]}})]})}function K({className:s}){return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:s,children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]})}export{xe as default};
