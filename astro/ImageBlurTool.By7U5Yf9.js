import{u as e,r as t,j as r}from"./vendor.Ml7xHclh.js";import{F as s}from"./fileUploader.B1Dwo65Z.js";import"./i18n.BsxyfPkU.js";import{m as l,R as n,D as a,U as o}from"./lucide-icons.CJY1ueNI.js";import"./utils.Ceoo1Swf.js";function i(){const{t:i}=e(),[c,u]=t.useState(null),[d,x]=t.useState(null),[g,h]=t.useState([]),[m,b]=t.useState(!1),[f,y]=t.useState({x:0,y:0}),[p,w]=t.useState({x:0,y:0}),[j,v]=t.useState(null),[_,N]=t.useState("blur"),[R,k]=t.useState(15),C=t.useRef(null),M=t.useRef(null),S=t.useCallback(()=>{if(!d||!C.current)return;const e=C.current,t=e.getContext("2d");if(t&&(e.width===d.width&&e.height===d.height||(e.width=d.width,e.height=d.height,M.current&&(M.current.width=d.width,M.current.height=d.height)),t.clearRect(0,0,e.width,e.height),t.drawImage(d,0,0),j&&j.w>0&&j.h>0)){const{x:e,y:r,w:s,h:l}=j;if(t.save(),t.beginPath(),t.rect(e,r,s,l),t.clip(),"blur"===_)t.filter=`blur(${R}px)`,t.drawImage(d,0,0),t.filter="none";else{const n=Math.max(2,Math.floor(R/3));for(let a=r;a<r+l;a+=n)for(let r=e;r<e+s;r+=n){const e=t.getImageData(r,a,1,1).data;t.fillStyle=`rgb(${e[0]},${e[1]},${e[2]})`,t.fillRect(r,a,n,n)}}t.restore()}},[d,j,_,R]);t.useEffect(()=>{S()},[S]);const L=e=>{if(!M.current)return{x:0,y:0};const t=M.current.getBoundingClientRect(),r=M.current.width/t.width,s=M.current.height/t.height;let l,n;return"touches"in e?(l=e.touches[0].clientX,n=e.touches[0].clientY):(l=e.clientX,n=e.clientY),{x:(l-t.left)*r,y:(n-t.top)*s}},U=e=>{if(!d)return;b(!0);const t=L(e);y(t),w(t)},I=e=>{if(!m||!d)return;const t=L(e);w(t),z(t)},D=()=>{if(!m)return;b(!1);const e=p.x-f.x,t=p.y-f.y;if(Math.abs(e)>10&&Math.abs(t)>10)E();else if(M.current){const e=M.current.getContext("2d");e?.clearRect(0,0,M.current.width,M.current.height)}},z=e=>{if(!M.current)return;const t=M.current.getContext("2d");if(!t)return;t.clearRect(0,0,M.current.width,M.current.height);const r=e.x-f.x,s=e.y-f.y;t.strokeStyle="#3b82f6",t.lineWidth=2,t.setLineDash([5,5]),t.strokeRect(f.x,f.y,r,s),t.fillStyle="rgba(59, 130, 246, 0.1)",t.fillRect(f.x,f.y,r,s)},E=()=>{const e=p.x-f.x,t=p.y-f.y;0!==Math.abs(e)&&0!==Math.abs(t)&&(v({x:e<0?p.x:f.x,y:t<0?p.y:f.y,w:Math.abs(e),h:Math.abs(t)}),requestAnimationFrame(()=>{if(!C.current)return;const e=C.current.toDataURL("image/png");h(t=>[...t,e]);const t=new Image;t.src=e,t.onload=()=>{if(x(t),v(null),y({x:0,y:0}),w({x:0,y:0}),M.current){const e=M.current.getContext("2d");e?.clearRect(0,0,M.current.width,M.current.height)}}}))};return r.jsx("div",{className:"max-w-5xl mx-auto",children:c?r.jsxs("div",{className:"flex flex-col lg:flex-row gap-6 w-full max-w-7xl",children:[r.jsxs("div",{className:"flex-1",children:[r.jsxs("p",{className:"text-center text-sm text-gray-500 mb-4 bg-blue-50 py-2 px-4 rounded-lg border border-blue-100",children:[r.jsx(l,{size:14,className:"inline mr-2"}),i("tools_ui.image_blur.instruction")]}),r.jsxs("div",{className:"relative overflow-auto border border-gray-200 rounded-xl shadow-lg bg-white w-fit max-w-150 max-h-150",children:[r.jsx("canvas",{ref:C,className:"block"}),r.jsx("canvas",{ref:M,onMouseDown:U,onMouseMove:I,onMouseUp:D,onMouseLeave:D,onTouchStart:U,onTouchMove:I,onTouchEnd:D,className:"absolute top-0 left-0 block touch-none cursor-crosshair",style:{pointerEvents:"auto"}})]})]}),r.jsx("div",{className:"w-full lg:w-80 shrink-0",children:r.jsxs("div",{className:"bg-white p-6 rounded-xl border border-gray-100 shadow-lg sticky top-6 space-y-6",children:[r.jsx("h3",{className:"text-lg font-bold text-gray-900",children:i("tools_ui.image_blur.settings")}),r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:i("tools_ui.image_blur.effect_type")}),r.jsxs("div",{className:"flex bg-gray-100 p-1 rounded-lg",children:[r.jsx("button",{onClick:()=>N("blur"),className:"flex-1 px-3 py-2 rounded text-sm font-semibold transition-all "+("blur"===_?"bg-white text-blue-600 shadow-sm":"text-gray-600"),children:i("tools_ui.image_blur.blur")}),r.jsx("button",{onClick:()=>N("pixelate"),className:"flex-1 px-3 py-2 rounded text-sm font-semibold transition-all "+("pixelate"===_?"bg-white text-purple-600 shadow-sm":"text-gray-600"),children:i("tools_ui.image_blur.pixelate")})]})]}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex justify-between items-center mb-2",children:[r.jsx("label",{className:"text-sm font-medium text-gray-700",children:i("tools_ui.image_blur.intensity")}),r.jsx("span",{className:"text-sm font-bold text-blue-600",children:R})]}),r.jsx("input",{type:"range",min:"5",max:"50",value:R,onChange:e=>k(Number(e.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600"}),r.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[r.jsx("span",{children:i("tools_ui.image_blur.light")}),r.jsx("span",{children:i("tools_ui.image_blur.heavy")})]})]}),r.jsxs("div",{className:"border-t border-gray-200 pt-6 space-y-3",children:[r.jsxs("button",{onClick:()=>{if(g.length<=1)return;const e=[...g];e.pop();const t=e[e.length-1];h(e);const r=new Image;r.src=t,r.onload=()=>{x(r),v(null),y({x:0,y:0}),w({x:0,y:0})}},disabled:g.length<=1,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-orange-600 text-white hover:bg-orange-700 rounded-lg font-bold text-sm disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[r.jsx(n,{size:18})," ",i("tools_ui.image_blur.undo")]}),r.jsxs("button",{onClick:()=>{if(!c)return;const e=new Image;e.src=c,e.onload=()=>{if(x(e),v(null),y({x:0,y:0}),w({x:0,y:0}),M.current){const e=M.current.getContext("2d");e?.clearRect(0,0,M.current.width,M.current.height)}}},className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium text-sm transition-colors",children:[r.jsx(n,{size:18})," ",i("tools_ui.image_blur.reset")]})]}),r.jsxs("div",{className:"border-t border-gray-200 pt-6 space-y-3",children:[r.jsxs("button",{onClick:()=>{C.current&&C.current.toBlob(e=>{if(e){const t=URL.createObjectURL(e),r=document.createElement("a");r.href=t,r.download="blurred-image.png",r.click(),URL.revokeObjectURL(t)}})},className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-gray-900 text-white hover:bg-black rounded-lg font-bold text-sm transition-colors",children:[r.jsx(a,{size:18})," ",i("tools_ui.image_blur.download")]}),r.jsxs("button",{onClick:()=>window.location.reload(),className:"w-full flex items-center justify-center gap-2 px-4 py-3 border-2 border-gray-300 hover:border-gray-400 text-gray-700 rounded-lg font-medium text-sm transition-colors",children:[r.jsx(o,{size:18})," ",i("tools_ui.image_blur.upload_new")]})]})]})})]}):r.jsx(s,{onFilesSelected:e=>{if(e&&e.length>0){const t=new FileReader;t.addEventListener("load",()=>{const e=new Image;e.src=t.result,e.onload=()=>{u(t.result),x(e),h([t.result]),v(null),y({x:0,y:0}),w({x:0,y:0})}}),t.readAsDataURL(e[0])}},accept:{"image/*":[".jpg",".jpeg",".png",".webp",".gif"]},multiple:!1,title:i("tools_ui.image_blur.upload_title")})})}export{i as default};
