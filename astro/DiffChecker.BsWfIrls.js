import{j as n}from"./jsx-runtime.D_zvdyIk.js";import{r as L}from"./index.BR1w_nJd.js";import"./i18n.0Kt4fEA7.js";import{u as q}from"./useTranslation.C-NthtKk.js";import{G as O}from"./git-compare.HuM2CPE2.js";import{T as V}from"./trash-2.CDySnx-i.js";import{A as G}from"./arrow-right-left.BNv3IpPw.js";import{R as F}from"./rotate-ccw.3wE7q0Bs.js";import{C as H}from"./check.DST6BrT9.js";import{C as J}from"./copy.C0lunkjJ.js";import{A as K}from"./arrow-right.CjLN0sOZ.js";import"./_commonjsHelpers.D6-XlEtG.js";import"./createLucideIcon._FvKnKwF.js";class Q{diff(e,r,t={}){let o;typeof t=="function"?(o=t,t={}):"callback"in t&&(o=t.callback);const i=this.castInput(e,t),f=this.castInput(r,t),g=this.removeEmpty(this.tokenize(i,t)),a=this.removeEmpty(this.tokenize(f,t));return this.diffWithOptionsObj(g,a,t,o)}diffWithOptionsObj(e,r,t,o){var i;const f=d=>{if(d=this.postProcess(d,t),o){setTimeout(function(){o(d)},0);return}else return d},g=r.length,a=e.length;let m=1,l=g+a;t.maxEditLength!=null&&(l=Math.min(l,t.maxEditLength));const w=(i=t.timeout)!==null&&i!==void 0?i:1/0,j=Date.now()+w,p=[{oldPos:-1,lastComponent:void 0}];let b=this.extractCommon(p[0],r,e,0,t);if(p[0].oldPos+1>=a&&b+1>=g)return f(this.buildValues(p[0].lastComponent,r,e));let P=-1/0,I=1/0;const D=()=>{for(let d=Math.max(P,-m);d<=Math.min(I,m);d+=2){let y;const C=p[d-1],s=p[d+1];C&&(p[d-1]=void 0);let h=!1;if(s){const u=s.oldPos-d;h=s&&0<=u&&u<g}const x=C&&C.oldPos+1<a;if(!h&&!x){p[d]=void 0;continue}if(!x||h&&C.oldPos<s.oldPos?y=this.addToPath(s,!0,!1,0,t):y=this.addToPath(C,!1,!0,1,t),b=this.extractCommon(y,r,e,d,t),y.oldPos+1>=a&&b+1>=g)return f(this.buildValues(y.lastComponent,r,e))||!0;p[d]=y,y.oldPos+1>=a&&(I=Math.min(I,d-1)),b+1>=g&&(P=Math.max(P,d+1))}m++};if(o)(function d(){setTimeout(function(){if(m>l||Date.now()>j)return o(void 0);D()||d()},0)})();else for(;m<=l&&Date.now()<=j;){const d=D();if(d)return d}}addToPath(e,r,t,o,i){const f=e.lastComponent;return f&&!i.oneChangePerToken&&f.added===r&&f.removed===t?{oldPos:e.oldPos+o,lastComponent:{count:f.count+1,added:r,removed:t,previousComponent:f.previousComponent}}:{oldPos:e.oldPos+o,lastComponent:{count:1,added:r,removed:t,previousComponent:f}}}extractCommon(e,r,t,o,i){const f=r.length,g=t.length;let a=e.oldPos,m=a-o,l=0;for(;m+1<f&&a+1<g&&this.equals(t[a+1],r[m+1],i);)m++,a++,l++,i.oneChangePerToken&&(e.lastComponent={count:1,previousComponent:e.lastComponent,added:!1,removed:!1});return l&&!i.oneChangePerToken&&(e.lastComponent={count:l,previousComponent:e.lastComponent,added:!1,removed:!1}),e.oldPos=a,m}equals(e,r,t){return t.comparator?t.comparator(e,r):e===r||!!t.ignoreCase&&e.toLowerCase()===r.toLowerCase()}removeEmpty(e){const r=[];for(let t=0;t<e.length;t++)e[t]&&r.push(e[t]);return r}castInput(e,r){return e}tokenize(e,r){return Array.from(e)}join(e){return e.join("")}postProcess(e,r){return e}get useLongestToken(){return!1}buildValues(e,r,t){const o=[];let i;for(;e;)o.push(e),i=e.previousComponent,delete e.previousComponent,e=i;o.reverse();const f=o.length;let g=0,a=0,m=0;for(;g<f;g++){const l=o[g];if(l.removed)l.value=this.join(t.slice(m,m+l.count)),m+=l.count;else{if(!l.added&&this.useLongestToken){let w=r.slice(a,a+l.count);w=w.map(function(j,p){const b=t[m+p];return b.length>j.length?b:j}),l.value=this.join(w)}else l.value=this.join(r.slice(a,a+l.count));a+=l.count,l.added||(m+=l.count)}}return o}}class U extends Q{constructor(){super(...arguments),this.tokenize=Z}equals(e,r,t){return t.ignoreWhitespace?((!t.newlineIsToken||!e.includes(`
`))&&(e=e.trim()),(!t.newlineIsToken||!r.includes(`
`))&&(r=r.trim())):t.ignoreNewlineAtEof&&!t.newlineIsToken&&(e.endsWith(`
`)&&(e=e.slice(0,-1)),r.endsWith(`
`)&&(r=r.slice(0,-1))),super.equals(e,r,t)}}const X=new U;function Y(c,e,r){return X.diff(c,e,r)}function Z(c,e){e.stripTrailingCr&&(c=c.replace(/\r\n/g,`
`));const r=[],t=c.split(/(\n|\r\n)/);t[t.length-1]||t.pop();for(let o=0;o<t.length;o++){const i=t[o];o%2&&!e.newlineIsToken?r[r.length-1]+=i:r.push(i)}return r}function he(){const{t:c}=q(),[e,r]=L.useState(""),[t,o]=L.useState(""),[i,f]=L.useState([]),[g,a]=L.useState({additions:0,removals:0}),[m,l]=L.useState({}),w=(s,h)=>{if(!s&&!h){f([]),a({additions:0,removals:0}),l({});return}const x=Y(s,h),u=[];let S=1,E=1,M=0,_=0;for(let v=0;v<x.length;v++){const T=x[v],z=T.value.replace(/\n$/,"").split(`
`);if(T.added){M+=T.count||0;let N=0;for(let k=u.length-1;k>=0&&(u[k].rightType==="empty"&&u[k].leftType==="removed");k--)N++;let A=u.length-N;const B=u.length;z.forEach(k=>{A<B?(u[A].rightContent=k,u[A].rightType="added",u[A].rightLineNumber=E++,A++):u.push({leftLineNumber:null,leftContent:null,leftType:"empty",rightLineNumber:E++,rightContent:k,rightType:"added"})})}else T.removed?(_+=T.count||0,z.forEach(N=>{u.push({leftLineNumber:S++,leftContent:N,leftType:"removed",rightLineNumber:null,rightContent:null,rightType:"empty"})})):z.forEach(N=>{u.push({leftLineNumber:S++,leftContent:N,leftType:"unchanged",rightLineNumber:E++,rightContent:N,rightType:"unchanged"})})}let $=0,R=!1;const W=u.map(v=>v.leftType!=="unchanged"||v.rightType!=="unchanged"?(R||($++,R=!0),{...v,blockId:`block-${$}`}):(R=!1,v));f(W),a({additions:M,removals:_}),l({})},j=()=>{w(e,t)},p=()=>{const s=t,h=e;r(s),o(h),w(s,h)},b=()=>{r(""),o(""),f([]),a({additions:0,removals:0}),l({})},P=()=>{r(`function add(a, b) {
  return a + b;
}
console.log(add(1, 2));`),o(`function add(a, b) {
  // Adding validation
  if (typeof a !== 'number' || typeof b !== 'number') return 0;
  return a + b;
}
console.log(add(1, 2));`),f([]),l({})},I=s=>{l(h=>{const x=h[s]||"right";return{...h,[s]:x==="right"?"left":"right"}})},D=()=>{const s={};i.forEach(h=>h.blockId&&(s[h.blockId]="left")),l(s)},d=()=>{l({})},y=L.useMemo(()=>i.length===0?"":i.map(s=>(s.blockId&&m[s.blockId]||"right")==="right"?s.rightType==="empty"?null:s.rightContent:s.leftType==="empty"?null:s.leftContent).filter(s=>s!==null).join(`
`),[i,m]),C=()=>{navigator.clipboard.writeText(y)};return n.jsxs("div",{className:"max-w-[1600px] mx-auto p-4 sm:p-6 lg:p-8",children:[n.jsxs("div",{className:"flex items-center justify-between mb-8",children:[n.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[n.jsx(O,{className:"w-8 h-8 text-cyan-600"}),c("tools_ui.diff_checker.title")]}),n.jsxs("div",{className:"flex gap-3",children:[n.jsxs("button",{onClick:b,className:"px-4 py-2 text-sm font-medium text-gray-600 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 flex items-center gap-2",children:[n.jsx(V,{className:"w-4 h-4"})," ",c("tools_ui.common.clear")]}),n.jsx("button",{onClick:P,className:"px-4 py-2 text-sm font-medium text-cyan-600 bg-cyan-50 rounded-lg hover:bg-cyan-100 flex items-center gap-2",children:c("tools_ui.common.load_sample")})]})]}),n.jsxs("div",{className:"flex flex-col md:flex-row gap-4 h-[300px] mb-8 relative items-center",children:[n.jsxs("div",{className:"flex flex-col border border-gray-200 rounded-xl overflow-hidden bg-white shadow-sm flex-1 h-full w-full",children:[n.jsx("div",{className:"px-4 py-2 bg-gray-50 border-b border-gray-100 flex justify-between items-center",children:n.jsx("span",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider",children:c("tools_ui.diff_checker.original_label")})}),n.jsx("textarea",{className:"flex-grow p-4 outline-none resize-none font-mono text-xs leading-5 bg-white",value:e,onChange:s=>r(s.target.value),placeholder:c("tools_ui.diff_checker.original_placeholder"),spellCheck:!1})]}),n.jsx("button",{onClick:p,className:"p-2 bg-white border border-gray-200 rounded-full shadow-sm hover:bg-gray-50 hover:text-cyan-600 transition-colors z-10 md:absolute md:left-1/2 md:top-1/2 md:-translate-x-1/2 md:-translate-y-1/2",title:"Swap Inputs",children:n.jsx(G,{className:"w-5 h-5"})}),n.jsxs("div",{className:"flex flex-col border border-gray-200 rounded-xl overflow-hidden bg-white shadow-sm flex-1 h-full w-full",children:[n.jsx("div",{className:"px-4 py-2 bg-gray-50 border-b border-gray-100 flex justify-between items-center",children:n.jsx("span",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider",children:c("tools_ui.diff_checker.modified_label")})}),n.jsx("textarea",{className:"flex-grow p-4 outline-none resize-none font-mono text-xs leading-5 bg-white",value:t,onChange:s=>o(s.target.value),placeholder:c("tools_ui.diff_checker.modified_placeholder"),spellCheck:!1})]})]}),n.jsx("div",{className:"flex justify-center mb-8",children:n.jsxs("button",{onClick:j,className:"flex items-center gap-2 px-8 py-3 bg-cyan-600 text-white font-semibold rounded-xl hover:bg-cyan-700 transition-colors shadow-lg shadow-cyan-600/20 text-lg",children:[n.jsx(O,{className:"w-5 h-5"})," ",c("tools_ui.diff_checker.find_diff")]})}),i.length>0&&n.jsxs("div",{className:"border border-gray-200 rounded-xl overflow-hidden bg-white shadow-sm mb-12",children:[n.jsxs("div",{className:"px-4 py-3 bg-gray-50 border-b border-gray-200 flex justify-between items-center flex-wrap gap-4",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("span",{className:"text-xs font-bold text-gray-700 uppercase tracking-wider",children:c("tools_ui.diff_checker.result_title")}),n.jsxs("div",{className:"flex gap-2",children:[g.removals>0&&n.jsxs("span",{className:"text-xs font-bold text-red-600 bg-red-50 px-2 py-0.5 rounded-full border border-red-100",children:["-",g.removals," removals"]}),g.additions>0&&n.jsxs("span",{className:"text-xs font-bold text-green-600 bg-green-50 px-2 py-0.5 rounded-full border border-green-100",children:["+",g.additions," additions"]})]})]}),n.jsxs("div",{className:"flex items-center gap-2 ml-auto",children:[n.jsxs("button",{onClick:D,className:"px-3 py-1.5 text-xs font-medium bg-white text-gray-700 border border-gray-200 rounded-md hover:bg-gray-50 hover:border-gray-300 transition-colors flex items-center gap-1.5 shadow-sm",children:[n.jsx(F,{className:"w-3.5 h-3.5"})," ",c("tools_ui.diff_checker.revert_all")]}),n.jsxs("button",{onClick:d,className:"px-3 py-1.5 text-xs font-medium bg-white text-gray-700 border border-gray-200 rounded-md hover:bg-gray-50 hover:border-gray-300 transition-colors flex items-center gap-1.5 shadow-sm",children:[n.jsx(H,{className:"w-3.5 h-3.5"})," ",c("tools_ui.diff_checker.accept_all")]}),n.jsx("div",{className:"h-6 w-px bg-gray-300 mx-2"}),n.jsxs("button",{onClick:C,className:"px-4 py-1.5 text-xs font-bold bg-cyan-600 text-white rounded-md hover:bg-cyan-700 flex items-center gap-1.5 shadow-sm shadow-cyan-600/20",children:[n.jsx(J,{className:"w-3.5 h-3.5"})," ",c("tools_ui.diff_checker.copy_merged")]})]})]}),n.jsx("div",{className:"font-mono text-xs leading-5 overflow-x-auto",children:n.jsxs("table",{className:"w-full border-collapse",children:[n.jsxs("colgroup",{children:[n.jsx("col",{width:"40px"}),n.jsx("col",{width:"50%"}),n.jsx("col",{width:"50px"}),n.jsx("col",{width:"40px"}),n.jsx("col",{width:"50%"})]}),n.jsx("tbody",{children:i.map((s,h)=>{const x=s.blockId,u=x&&m[x]||"right",S=s.leftType!=="unchanged"||s.rightType!=="unchanged",E=x&&(h===0||i[h-1].blockId!==x);let M=s.rightContent,_=s.rightType;return u==="left"&&S&&(M=s.leftContent,_=s.leftType==="removed"?"removed":"unchanged"),n.jsxs("tr",{className:"border-b border-gray-50 last:border-0 hover:bg-gray-50/50 group",children:[n.jsx("td",{className:`text-right pr-3 select-none text-gray-400 border-r border-gray-100 ${s.leftType==="removed"?"bg-red-50":"bg-white"}`,children:s.leftLineNumber}),n.jsx("td",{className:`pl-2 pr-2 whitespace-pre-wrap break-all ${s.leftType==="removed"?"bg-red-50 text-red-900":"text-gray-600"} ${u==="right"&&S?"opacity-60":""}`,children:s.leftContent||" "}),n.jsx("td",{className:"text-center bg-gray-50/30 border-l border-r border-gray-100 p-0 align-middle",children:E&&n.jsx("button",{onClick:()=>x&&I(x),className:`w-6 h-6 rounded-full flex items-center justify-center transition-all shadow-sm mx-auto ${u==="left"?"bg-green-600 text-white ring-2 ring-green-100 scale-110":"bg-white border border-gray-200 text-gray-400 hover:text-green-600 hover:border-green-300"}`,title:c(u==="left"?"tools_ui.diff_checker.status_reverted":"tools_ui.diff_checker.status_modified"),children:n.jsx(K,{className:"w-3.5 h-3.5"})})}),n.jsx("td",{className:`text-right pr-3 select-none text-gray-400 border-r border-gray-100 ${_==="added"?"bg-green-50":"bg-white"}`,children:s.rightLineNumber}),n.jsx("td",{className:`pl-2 pr-2 whitespace-pre-wrap break-all ${_==="added"?"bg-green-50 text-green-900":"text-gray-600"}`,children:M||" "})]},h)})})]})})]})]})}export{he as default};
