import{j as s}from"./jsx-runtime.D_zvdyIk.js";import{r as v}from"./index.BR1w_nJd.js";import{P as j,a as f}from"./ProcessButton.CVFw6SxZ.js";import{J as B}from"./jszip.min.CL8lVgXJ.js";import{F as M}from"./fileUploader.e1Ms2KWN.js";import{F as w}from"./FileSaver.min.D-v3scGK.js";import{u as k,g as z}from"./pdf.DIkd52Y_.js";import{D as G,G as _}from"./DraggablePage.xYgCwIqn.js";import{u as K,a as S,D as R,c as T,S as q,r as J,b as O,s as U,K as Z,P as H,d as L}from"./sortable.esm.B6dza6V1.js";import{S as Q}from"./scissors.zT-dhgPn.js";import{F as V}from"./file-text.DcW9pNJ8.js";import"./_commonjsHelpers.D6-XlEtG.js";import"./utils.DXMiVD0-.js";import"./loader-circle.m7cZJHvs.js";import"./createLucideIcon._FvKnKwF.js";import"./_commonjs-dynamic-modules.TDtrdbi3.js";import"./index.BUxk5OiF.js";import"./preload-helper.BlTxHScW.js";import"./x.DlPzfmHM.js";import"./index.CYaNeMyK.js";import"./index.B80MxM07.js";function ye(){const{files:m,addFiles:D,filesRef:u,isProcessing:g,processingMessage:h,setProcessingState:d}=k({multiple:!0}),[i,x]=v.useState([]),[y,b]=v.useState(null),N=K(S(H),S(Z,{coordinateGetter:U})),P=async e=>{const o=u.current.length;D(e),d(!0,"Generating thumbnails...");try{const t=[];for(let a=0;a<e.length;a++){const c=e[a];d(!0,`Processing ${c.name}...`,Math.round((a+1)/e.length*100));try{(await z(c)).forEach((r,l)=>{t.push({id:`f${o+a}-p${l+1}-${Date.now()}-${Math.random()}`,fileIndex:o+a,pageIndex:l,image:r,fileName:c.name})})}catch(n){console.error(`Error processing ${c.name}:`,n)}}x(a=>[...a,...t])}catch(t){console.error(t),alert(`Error: ${t.message}`)}finally{d(!1)}},I=e=>{x(o=>o.filter(t=>t.id!==e))},F=e=>{const{active:o,over:t}=e;o.id!==t.id&&x(a=>{const c=a.findIndex(r=>r.id===o.id),n=a.findIndex(r=>r.id===t.id);return L(a,c,n)}),b(null)},E=async()=>{if(i.length!==0){d(!0,"Creating PDF...");try{const e=await f.create(),o=[...new Set(i.map(r=>r.fileIndex))],t={},a=u.current;for(const r of o){if(!a[r])continue;const l=await a[r].arrayBuffer();t[r]=await f.load(l)}for(const r of i){if(!t[r.fileIndex])continue;const l=t[r.fileIndex],[p]=await e.copyPages(l,[r.pageIndex]);e.addPage(p)}const c=await e.save(),n=new Blob([c],{type:"application/pdf"});w.saveAs(n,`splitted-rearranged-${Date.now()}.pdf`)}catch(e){console.error(e),alert("Error saving PDF")}finally{d(!1)}}},C=async()=>{if(i.length!==0){d(!0,"Extracting pages...");try{const e=new B,o=[...new Set(i.map(n=>n.fileIndex))],t={},a=u.current;for(const n of o){if(!a[n])continue;const r=await a[n].arrayBuffer();t[n]=await f.load(r)}for(let n=0;n<i.length;n++){const r=i[n];if(!t[r.fileIndex])continue;const l=t[r.fileIndex],p=await f.create(),[$]=await p.copyPages(l,[r.pageIndex]);p.addPage($);const A=await p.save();e.file(`Page_${n+1}_${r.fileName}`,A)}const c=await e.generateAsync({type:"blob"});w.saveAs(c,`extracted_pages_${Date.now()}.zip`)}catch(e){console.error(e),alert("Error extracting pages")}finally{d(!1)}}};return s.jsxs("div",{className:"space-y-8",children:[m.length>0&&s.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4 p-4 bg-gray-50 rounded-xl border border-gray-200",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Q,{className:"w-5 h-5 text-gray-500"}),s.jsx("span",{className:"font-medium text-gray-700",children:"Split & Organize Mode"})]}),s.jsxs("div",{className:"text-sm text-gray-500",children:[i.length," pages selected"]})]}),s.jsx("div",{className:"min-h-75",children:m.length===0?s.jsx(M,{onFilesSelected:P,accept:{"application/pdf":[".pdf"]},multiple:!0,title:"Upload PDF to Split"}):s.jsx("div",{className:"space-y-6",children:s.jsxs(R,{sensors:N,collisionDetection:T,onDragEnd:F,onDragStart:e=>b(e.active.id),children:[s.jsx(q,{items:i.map(e=>e.id),strategy:J,children:s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4",children:[i.map(e=>s.jsx(G,{...e,onRemove:I},e.id)),s.jsxs("div",{className:"aspect-3/4 flex items-center justify-center bg-gray-50 border-2 border-dashed border-gray-200 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",onClick:()=>document.getElementById("add-more-pdf-split")?.click(),children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-2",children:s.jsx("span",{className:"text-xl",children:"+"})}),s.jsx("span",{className:"text-xs text-gray-500 font-medium",children:"Add More"})]}),s.jsx("input",{id:"add-more-pdf-split",type:"file",multiple:!0,accept:".pdf",className:"hidden",onChange:e=>{e.target.files&&P(Array.from(e.target.files))}})]})]})}),s.jsx(O,{children:y?s.jsx("div",{className:"aspect-3/4 bg-white rounded-lg shadow-xl overflow-hidden opacity-90 cursor-grabbing border-2 border-blue-500",children:s.jsx("img",{src:i.find(e=>e.id===y)?.image,className:"w-full h-full object-contain p-2"})}):null})]})})}),m.length>0&&s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(j,{onClick:E,disabled:g,isProcessing:g&&h==="Creating PDF...",icon:V,processingMessage:"Saving...",progress:g?100:0,children:"Save as Single PDF"}),s.jsx(j,{onClick:C,disabled:g,isProcessing:g&&h==="Extracting pages...",icon:_,processingMessage:"Extracting...",className:"bg-purple-600 hover:bg-purple-700 shadow-purple-500/20",children:"Extract All as ZIP"})]})]})}export{ye as default};
