import{_ as H}from"./preload-helper.BlTxHScW.js";import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as h}from"./index.BR1w_nJd.js";import{P as T}from"./PDFButton.Bm7otZl6.js";import{F as re}from"./fileUploader.D55Ta1Pr.js";import{c as X}from"./utils.fNskMoFt.js";import{F as fe}from"./FileSaver.min.D-v3scGK.js";import{u as xe,a as ne,D as we,c as ye,S as be,r as je,b as ve,d as Pe,s as ke,K as Fe,P as Ne,e as Se,C as De}from"./sortable.esm.B22XIUkC.js";import{c as oe}from"./createLucideIcon._FvKnKwF.js";import{G as Ie}from"./grid-3x3.s6Fv8het.js";import{F as $e}from"./file-text.DcW9pNJ8.js";import{X as ie}from"./x.DlPzfmHM.js";import{L as Ee}from"./lock.BwDUyFyp.js";import{A as Ce}from"./arrow-down.BWPH-g_Y.js";import"./_commonjsHelpers.D6-XlEtG.js";import"./index.BUxk5OiF.js";import"./index.B80MxM07.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]],Me=oe("list",Be);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=[["path",{d:"m18 14 4 4-4 4",key:"10pe0f"}],["path",{d:"m18 2 4 4-4 4",key:"pucp1d"}],["path",{d:"M2 18h1.973a4 4 0 0 0 3.3-1.7l5.454-8.6a4 4 0 0 1 3.3-1.7H22",key:"1ailkh"}],["path",{d:"M2 6h1.972a4 4 0 0 1 3.6 2.2",key:"km57vx"}],["path",{d:"M22 18h-6.041a4 4 0 0 1-3.3-1.8l-.359-.45",key:"os18l9"}]],_e=oe("shuffle",Ue);function Te({id:p,image:v,fileName:y,pageIndex:f,onRemove:P}){const{attributes:k,listeners:j,setNodeRef:F,transform:N,transition:R,isDragging:$}=Se({id:p}),G={transform:De.Transform.toString(N),transition:R,zIndex:$?10:1,opacity:$?.5:1};return e.jsxs("div",{ref:F,style:G,...k,...j,className:"group relative aspect-3/4 bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-shadow cursor-grab active:cursor-grabbing",children:[e.jsx("img",{src:v,alt:`Page ${f+1}`,className:"w-full h-full object-contain p-2"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/5 transition-colors"}),e.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("button",{onPointerDown:E=>{E.stopPropagation(),P(p)},className:"p-1 bg-red-500 text-white rounded-full hover:bg-red-600 shadow-sm",children:e.jsx(ie,{className:"w-3 h-3"})})}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-white/90 backdrop-blur-sm p-2 text-xs text-gray-600 border-t border-gray-100 truncate",children:[y," - P",f+1]})]})}function tt(){const[p,v]=h.useState([]),y=h.useRef([]),[f,P]=h.useState([]),[k,j]=h.useState(!1),[F,N]=h.useState("list"),[R,$]=h.useState(null),[G,E]=h.useState({}),[L,C]=h.useState(null),[J,O]=h.useState(""),[z,q]=h.useState(!0),[Q,Y]=h.useState(0),[S,B]=h.useState(!1),[Z,M]=h.useState(null),[A,K]=h.useState([]),[ee,U]=h.useState(0),[le,V]=h.useState("Processing..."),ce=xe(ne(Ne),ne(Fe,{coordinateGetter:ke})),W=async(t,a="",o)=>{const l=await H(()=>import("./pdf.OfKI3oAY.js"),[]);l.GlobalWorkerOptions.workerSrc="/pdf.worker.min.mjs";const i=await l.getDocument({data:new Uint8Array(t),password:a||void 0}).promise,g=i.numPages,n=await T.create();for(let s=1;s<=g;s++){const d=await i.getPage(s),m=d.getViewport({scale:5}),u=document.createElement("canvas"),c=u.getContext("2d");if(u.width=m.width,u.height=m.height,c){await d.render({canvasContext:c,viewport:m}).promise;const x=u.toDataURL("image/png"),b=await fetch(x).then(I=>I.arrayBuffer()),w=await n.embedPng(b);n.addPage([w.width,w.height]).drawImage(w,{x:0,y:0,width:w.width,height:w.height})}o&&o(Math.round(s/g*100))}return await n.save()},_=async t=>{j(!0),U(0);const a=[],o=t.length;for(let n=0;n<t.length;n++){const s=t[n];V(`Checking file ${n+1}/${o}: ${s.name}`),U(Math.round(n/o*50));try{const d=await s.arrayBuffer();try{await T.load(d),a.push(s)}catch(m){if(m.message?.includes("encrypted")||m.name==="EncryptedPDFError"){V(`Unlocking ${s.name}...`);try{await T.load(d,{password:""}),a.push(s)}catch{try{const u=await W(d,"",b=>{const w=n/o*50,D=b/100*(50/o);U(Math.round(w+D))}),c=new Blob([u],{type:"application/pdf"}),x=new File([c],s.name,{type:"application/pdf"});a.push(x)}catch{const c=y.current,x=c.length+a.length;M(s);const b=t.slice(n+1);K(b),C({fileIndex:x,fileName:s.name}),j(!1);const w=[...c,...a,s];v(w),y.current=w;return}}}else throw m}}catch(d){console.error(`Error processing ${s.name}:`,d),a.push(s)}}const l=y.current,r=[...l,...a];v(r),y.current=r;const i=[];let g=l.length;try{V("Generating thumbnails...");const n=await H(()=>import("./pdf.OfKI3oAY.js"),[]);n.GlobalWorkerOptions.workerSrc="/pdf.worker.min.mjs";for(let s=0;s<a.length;s++){const d=a[s];U(50+Math.round((s+1)/a.length*50));try{const m=await d.arrayBuffer();let u;try{u=await n.getDocument({data:m}).promise}catch(c){if(c.name==="PasswordException")u=await n.getDocument({data:m,password:""}).promise;else throw c}for(let c=1;c<=u.numPages;c++){const x=50+s/a.length*50,b=c/u.numPages*(50/a.length);U(Math.round(x+b)),V(`Generating thumbnails ${s+1}/${a.length}: page ${c}/${u.numPages}`);const w=await u.getPage(c),D=w.getViewport({scale:.5}),I=document.createElement("canvas"),ae=I.getContext("2d");I.height=D.height,I.width=D.width,ae&&(await w.render({canvasContext:ae,viewport:D}).promise,i.push({id:`f${g+s}-p${c}-${Date.now()}-${Math.random()}`,fileIndex:g+s,pageIndex:c-1,image:I.toDataURL(),fileName:d.name}))}}catch(m){console.warn(`Skipping thumbnail generation for ${d.name}:`,m)}}P(s=>[...s,...i]),r.length>0&&N("grid")}catch(n){console.error("Error processing PDF:",n),alert(`Failed to load PDF: ${n?.message||"Unknown error"}. Check console for details.`)}finally{j(!1)}},de=t=>{const a=p.filter((l,r)=>r!==t);v(a),y.current=a,P(l=>l.filter(r=>r.fileIndex!==t).map(r=>({...r,fileIndex:r.fileIndex>t?r.fileIndex-1:r.fileIndex})));const o={...G};delete o[t],Object.keys(o).forEach(l=>{const r=parseInt(l);r>t&&(o[r-1]=o[r],delete o[r])}),E(o)},ge=t=>{P(a=>a.filter(o=>o.id!==t))},me=t=>{const{active:a,over:o}=t;a.id!==o.id&&P(l=>{const r=l.findIndex(g=>g.id===a.id),i=l.findIndex(g=>g.id===o.id);return Pe(l,r,i)}),$(null)},ue=t=>{$(t.active.id)},pe=()=>{P(t=>{const a=[...t];for(let o=a.length-1;o>0;o--){const l=Math.floor(Math.random()*(o+1));[a[o],a[l]]=[a[l],a[o]]}return a})},te=async()=>{if(!L)return;const{fileIndex:t,fileName:a}=L,o=J,l=Z||p[t];if(!l){alert("File not found");return}if(O(""),z)try{const r=await l.arrayBuffer();B(!0);const i=await W(r,o,s=>{Y(s)});B(!1);const g=new Blob([i],{type:"application/pdf"}),n=new File([g],a,{type:"application/pdf"});if(Z){const s=[...p];s[t]=n,v(s),y.current=s,M(null)}else{const s=[...p];s[t]=n,v(s),y.current=s}if(await se([n],t),E(s=>({...s,[t]:""})),q(!0),C(null),A.length>0){const s=A;K([]),setTimeout(()=>_(s),100)}}catch(r){alert(`Force unlock failed: ${r?.message||"Unknown error"}`),M(null),B(!1),C(null)}else{B(!0);try{const r=await l.arrayBuffer(),i=await W(r,o,d=>{Y(d)}),g=new Blob([i],{type:"application/pdf"}),n=new File([g],a,{type:"application/pdf"}),s=[...p];if(s[t]=n,v(s),y.current=s,E(d=>({...d,[t]:""})),await se([n],t),M(null),C(null),A.length>0){const d=A;K([]),setTimeout(()=>_(d),100)}}catch(r){r.message?.includes("encrypted")||r.message?.includes("ignoreEncryption")?(alert(`This PDF uses encryption that requires Force Unlock.

Please:
1. Check the "Force Unlock (Flatten PDF)" option
2. Re-enter your password (or leave empty)
3. Click Submit again`),O(""),q(!0)):(alert(`Password incorrect or unlock failed: ${r?.message||"Unknown error"}`),C(null)),M(null)}finally{B(!1)}}},se=async(t,a,o)=>{const l=await H(()=>import("./pdf.OfKI3oAY.js"),[]);l.GlobalWorkerOptions.workerSrc="/pdf.worker.min.mjs";const r=[];for(let i=0;i<t.length;i++){const g=t[i],n=await g.arrayBuffer(),d=await l.getDocument({data:n,password:void 0}).promise;for(let m=1;m<=d.numPages;m++){const u=await d.getPage(m),c=u.getViewport({scale:.5}),x=document.createElement("canvas"),b=x.getContext("2d");x.height=c.height,x.width=c.width,b&&(await u.render({canvasContext:b,viewport:c}).promise,r.push({id:`f${a+i}-p${m}-${Date.now()}-${Math.random()}`,fileIndex:a+i,pageIndex:m-1,image:x.toDataURL(),fileName:g.name}))}}P(i=>[...i,...r]),p.length>0&&N("grid")},he=async()=>{if(f.length!==0){j(!0);try{const t=await T.create(),a=[...new Set(f.map(i=>i.fileIndex))],o={};for(const i of a){const g=y.current;try{const n=await g[i].arrayBuffer();o[i]=await T.load(n)}catch(n){if(n.message?.includes("encrypted")){console.error(`File ${p[i].name} is still encrypted at merge time`),alert(`ERROR: File "${p[i].name}" is still encrypted.

This shouldn't happen. Please:
1. Clear all files
2. Re-upload your files
3. Ensure Force Unlock is enabled (should be default)`),j(!1);return}else{console.error(`Error loading file ${p[i].name}:`,n),alert(`Failed to load ${p[i].name}: ${n.message}`),j(!1);return}}}for(const i of f){const g=o[i.fileIndex],[n]=await t.copyPages(g,[i.pageIndex]);t.addPage(n)}const l=await t.save(),r=new Blob([l],{type:"application/pdf"});fe.saveAs(r,`merged-document-${Date.now()}.pdf`)}catch(t){console.error("Error merging PDFs:",t),alert("Failed to merge PDFs. Please try again.")}finally{j(!1)}}};return e.jsxs("div",{className:"space-y-8",children:[p.length>0&&e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4 p-4 bg-gray-50 rounded-xl border border-gray-200",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>N("list"),className:X("p-2 rounded-lg transition-colors",F==="list"?"bg-white shadow text-blue-600":"text-gray-500 hover:bg-gray-200"),title:"File List View",children:e.jsx(Me,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>N("grid"),className:X("p-2 rounded-lg transition-colors",F==="grid"?"bg-white shadow text-blue-600":"text-gray-500 hover:bg-gray-200"),title:"Page Grid View",children:e.jsx(Ie,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:pe,className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(_e,{className:"w-4 h-4"})," Shuffle"]}),e.jsxs("span",{className:"text-sm text-gray-500 self-center",children:[f.length," pages"]})]})]}),e.jsx("div",{className:"min-h-75",children:p.length===0?e.jsx(re,{onFilesSelected:_,accept:{"application/pdf":[".pdf"]},multiple:!0}):e.jsxs(e.Fragment,{children:[F==="list"&&e.jsxs("div",{className:"space-y-3",children:[p.map((t,a)=>e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-xl bg-gray-50 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($e,{className:"w-5 h-5 text-red-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:t.name}),e.jsxs("span",{className:"text-xs text-gray-400",children:["(",(t.size/1024/1024).toFixed(2)," MB)"]})]}),e.jsx("button",{onClick:()=>de(a),className:"p-1.5 hover:bg-gray-200 rounded-full text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(ie,{className:"w-4 h-4"})})]},`${t.name}-${a}`)),e.jsx("div",{className:"mt-6",children:e.jsx(re,{onFilesSelected:_,accept:{"application/pdf":[".pdf"]},multiple:!0,className:"py-8"})})]}),F==="grid"&&e.jsxs(we,{sensors:ce,collisionDetection:ye,onDragEnd:me,onDragStart:ue,children:[e.jsx(be,{items:f.map(t=>t.id),strategy:je,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4",children:[f.map(t=>e.jsx(Te,{...t,onRemove:ge},t.id)),e.jsxs("div",{className:"aspect-3/4 flex items-center justify-center bg-gray-50 border-2 border-dashed border-gray-200 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",onClick:()=>document.getElementById("add-more-pdf")?.click(),children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-2",children:e.jsx("span",{className:"text-xl",children:"+"})}),e.jsx("span",{className:"text-xs text-gray-500 font-medium",children:"Add More"})]}),e.jsx("input",{id:"add-more-pdf",type:"file",multiple:!0,accept:".pdf",className:"hidden",onChange:t=>{t.target.files&&_(Array.from(t.target.files))}})]})]})}),e.jsx(ve,{children:R?e.jsx("div",{className:"aspect-3/4 bg-white rounded-lg shadow-xl overflow-hidden opacity-90 cursor-grabbing border-2 border-blue-500",children:e.jsx("img",{src:f.find(t=>t.id===R)?.image,className:"w-full h-full object-contain p-2"})}):null})]})]})}),L&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 text-red-600 rounded-full flex items-center justify-center",children:e.jsx(Ee,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Password Required"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["File: ",L.fileName]})]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"This PDF is password protected. Please enter the password to continue merging."}),e.jsx("input",{type:"password",value:J,onChange:t=>O(t.target.value),onKeyDown:t=>t.key==="Enter"&&!S&&te(),placeholder:"Enter password (or leave empty)",className:"w-full px-4 py-3 rounded-lg border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all",autoFocus:!0,disabled:S}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",id:"force-unlock-merge",checked:z,onChange:t=>q(t.target.checked),className:"mt-1 w-4 h-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500",disabled:S}),e.jsxs("label",{htmlFor:"force-unlock-merge",className:"text-sm text-gray-700 cursor-pointer",children:[e.jsx("span",{className:"font-semibold block text-gray-900",children:"Force Unlock (Flatten PDF)"}),e.jsx("span",{className:"text-gray-500",children:"Enable if password doesn't work. Converts pages to images (high quality)."})]})]}),S&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[e.jsx("span",{children:"Unlocking PDF..."}),e.jsxs("span",{className:"font-medium",children:[Q,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"bg-blue-600 h-full transition-all duration-300",style:{width:`${Q}%`}})})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{onClick:te,disabled:S,className:"w-full px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:S?"Processing...":"Submit"})}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:z?"Force Unlock will flatten the PDF by rendering pages as high-quality images.":`Tip: Check "Force Unlock" if you don't know the password or standard unlock fails.`})]})}),e.jsxs("button",{onClick:he,disabled:k||f.length<1,className:X("w-full py-4 rounded-xl font-bold text-lg shadow-lg relative overflow-hidden transition-all transform active:scale-95",f.length>=1&&!k?"bg-blue-600 hover:bg-blue-700 text-white shadow-blue-500/20":"bg-gray-100 text-gray-400 cursor-not-allowed"),children:[k&&e.jsx("div",{className:"absolute inset-0 bg-blue-600 transition-all duration-300",style:{width:`${ee}%`}}),e.jsx("span",{className:"relative z-10 flex items-center justify-center gap-2",children:k?e.jsxs(e.Fragment,{children:[le," - ",ee,"%"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"w-5 h-5"})," Merge ",f.length," Pages"]})})]})]})}export{tt as default};
