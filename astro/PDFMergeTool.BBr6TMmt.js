import{_ as oe}from"./preload-helper.BlTxHScW.js";import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as p}from"./index.BR1w_nJd.js";import{P as ie,a as $}from"./ProcessButton.BKm5qs89.js";import{F as H}from"./fileUploader.D55Ta1Pr.js";import{c as W}from"./utils.fNskMoFt.js";import{F as ce}from"./FileSaver.min.D-v3scGK.js";import{u as de,p as _,i as ge}from"./pdf.BWFj-41E.js";import{G as pe,D as me}from"./DraggablePage.xYgCwIqn.js";import{u as ue,a as X,D as fe,c as he,S as xe,r as ye,b as we,d as be,s as je,K as Fe,P as ke}from"./sortable.esm.B6dza6V1.js";import{c as J}from"./createLucideIcon._FvKnKwF.js";import{F as Ne}from"./file-text.DcW9pNJ8.js";import{X as ve}from"./x.DlPzfmHM.js";import{L as Pe}from"./lock.BwDUyFyp.js";import{A as De}from"./arrow-down.BWPH-g_Y.js";import"./_commonjsHelpers.D6-XlEtG.js";import"./loader-circle.m7cZJHvs.js";import"./index.BUxk5OiF.js";import"./index.CYaNeMyK.js";import"./index.B80MxM07.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]],Ie=J("list",Se);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=[["path",{d:"m18 14 4 4-4 4",key:"10pe0f"}],["path",{d:"m18 2 4 4-4 4",key:"pucp1d"}],["path",{d:"M2 18h1.973a4 4 0 0 0 3.3-1.7l5.454-8.6a4 4 0 0 1 3.3-1.7H22",key:"1ailkh"}],["path",{d:"M2 6h1.972a4 4 0 0 1 3.6 2.2",key:"km57vx"}],["path",{d:"M22 18h-6.041a4 4 0 0 1-3.3-1.8l-.359-.45",key:"os18l9"}]],Be=J("shuffle",$e);function Ze(){const{files:k,addFiles:R,removeFile:Q,replaceFile:A,filesRef:N,isProcessing:L,processingProgress:Y,processingMessage:Z,setProcessingState:d}=de({multiple:!0}),[m,y]=p.useState([]),[v,B]=p.useState("list"),[T,G]=p.useState(null),[Me,q]=p.useState({}),[P,w]=p.useState(null),[z,M]=p.useState(""),[C,E]=p.useState(!0),[V,K]=p.useState(0),[x,b]=p.useState(!1),[ee,j]=p.useState(null),[D,U]=p.useState([]),te=ue(X(ke),X(Fe,{coordinateGetter:je})),F=async t=>{d(!0,"Processing files...",0);const a=[],r=t.length;for(let n=0;n<t.length;n++){const s=t[n];d(!0,`Checking file ${n+1}/${r}: ${s.name}`,Math.round(n/r*50));try{const o=await s.arrayBuffer();try{await $.load(o),a.push(s)}catch(i){if(i.message?.includes("encrypted")||i.name==="EncryptedPDFError"){d(!0,`Unlocking ${s.name}...`);try{await $.load(o,{password:""}),a.push(s)}catch{try{const l=await _(o,"",h=>{const u=n/r*50,I=h/100*(50/r);d(!0,`Unlocking ${s.name}...`,Math.round(u+I))}),g=new Blob([l],{type:"application/pdf"}),f=new File([g],s.name,{type:"application/pdf"});a.push(f)}catch{const f=N.current.length+a.length;j(s);const h=t.slice(n+1);U(h),w({fileIndex:f,fileName:s.name}),d(!1);const u=N.current.length;R([...a,s]),a.length>0&&S(a,u);return}}}else throw i}}catch(o){console.error(`Error processing ${s.name}:`,o),a.push(s)}}const c=N.current.length;R(a),await S(a,c)},S=async(t,a,r)=>{d(!0,"Generating thumbnails...");const c=await oe(()=>import("./pdf.OfKI3oAY.js"),[]);await ge();const n=[];for(let s=0;s<t.length;s++){const o=t[s];d(!0,`Generating thumbnails ${s+1}/${t.length}`,50+Math.round((s+1)/t.length*50));try{const i=await o.arrayBuffer();let l;try{l=await c.getDocument({data:i}).promise}catch(g){if(g.name==="PasswordException")l=await c.getDocument({data:i,password:""}).promise;else throw g}for(let g=1;g<=l.numPages;g++){const f=await l.getPage(g),h=f.getViewport({scale:.5}),u=document.createElement("canvas"),I=u.getContext("2d");u.height=h.height,u.width=h.width,I&&(await f.render({canvasContext:I,viewport:h}).promise,n.push({id:`f${a+s}-p${g}-${Date.now()}-${Math.random()}`,fileIndex:a+s,pageIndex:g-1,image:u.toDataURL(),fileName:o.name}))}}catch(i){console.warn(`Skipping thumbnail generation for ${o.name}:`,i)}}y(s=>[...s,...n]),t.length>0&&B("grid"),d(!1)},se=t=>{Q(t),y(a=>a.filter(r=>r.fileIndex!==t).map(r=>({...r,fileIndex:r.fileIndex>t?r.fileIndex-1:r.fileIndex})))},ae=t=>{y(a=>a.filter(r=>r.id!==t))},re=t=>{const{active:a,over:r}=t;a.id!==r.id&&y(c=>{const n=c.findIndex(o=>o.id===a.id),s=c.findIndex(o=>o.id===r.id);return be(c,n,s)}),G(null)},ne=()=>{y(t=>{const a=[...t];for(let r=a.length-1;r>0;r--){const c=Math.floor(Math.random()*(r+1));[a[r],a[c]]=[a[c],a[r]]}return a})},O=async()=>{if(!P)return;const{fileIndex:t,fileName:a}=P,r=z,c=ee||k[t];if(!c){alert("File not found");return}if(M(""),C)try{const n=await c.arrayBuffer();b(!0);const s=await _(n,r,l=>{K(l)});b(!1);const o=new Blob([s],{type:"application/pdf"}),i=new File([o],a,{type:"application/pdf"});if(A(t,i),await S([i],t),q(l=>({...l,[t]:""})),E(!0),w(null),j(null),D.length>0){const l=D;U([]),setTimeout(()=>F(l),100)}}catch(n){alert(`Force unlock failed: ${n?.message||"Unknown error"}`),j(null),b(!1),w(null)}else{b(!0);try{const n=await c.arrayBuffer(),s=await _(n,r,l=>{K(l)}),o=new Blob([s],{type:"application/pdf"}),i=new File([o],a,{type:"application/pdf"});if(A(t,i),q(l=>({...l,[t]:""})),await S([i],t),j(null),w(null),D.length>0){const l=D;U([]),setTimeout(()=>F(l),100)}}catch(n){n.message?.includes("encrypted")||n.message?.includes("ignoreEncryption")?(alert(`This PDF uses encryption that requires Force Unlock.

Please:
1. Check the "Force Unlock (Flatten PDF)" option
2. Re-enter your password (or leave empty)
3. Click Submit again`),M(""),E(!0)):(alert(`Password incorrect or unlock failed: ${n?.message||"Unknown error"}`),w(null)),j(null)}finally{b(!1)}}},le=async()=>{if(m.length!==0){d(!0,"Merging PDFs...");try{const t=await $.create(),a=[...new Set(m.map(s=>s.fileIndex))],r={};for(const s of a){const o=N.current;if(!o[s]){console.warn(`File at index ${s} not found, skipping.`);continue}try{const i=await o[s].arrayBuffer();r[s]=await $.load(i)}catch(i){const l=o[s]?.name||"Unknown File";if(i.message?.includes("encrypted")){console.error(`File ${l} is still encrypted at merge time`),alert(`ERROR: File "${l}" is still encrypted.`),d(!1);return}else{console.error(`Error loading file ${l}:`,i),alert(`Failed to load ${l}: ${i.message}`),d(!1);return}}}for(const s of m){if(!r[s.fileIndex])continue;const o=r[s.fileIndex],[i]=await t.copyPages(o,[s.pageIndex]);t.addPage(i)}const c=await t.save(),n=new Blob([c],{type:"application/pdf"});ce.saveAs(n,`merged-document-${Date.now()}.pdf`)}catch(t){console.error("Error merging PDFs:",t),alert("Failed to merge PDFs. Please try again.")}finally{d(!1)}}};return e.jsxs("div",{className:"space-y-8",children:[k.length>0&&e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4 p-4 bg-gray-50 rounded-xl border border-gray-200",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>B("list"),className:W("p-2 rounded-lg transition-colors",v==="list"?"bg-white shadow text-blue-600":"text-gray-500 hover:bg-gray-200"),title:"File List View",children:e.jsx(Ie,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>B("grid"),className:W("p-2 rounded-lg transition-colors",v==="grid"?"bg-white shadow text-blue-600":"text-gray-500 hover:bg-gray-200"),title:"Page Grid View",children:e.jsx(pe,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:ne,className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(Be,{className:"w-4 h-4"})," Shuffle"]}),e.jsxs("span",{className:"text-sm text-gray-500 self-center",children:[m.length," pages"]})]})]}),e.jsx("div",{className:"min-h-75",children:k.length===0?e.jsx(H,{onFilesSelected:F,accept:{"application/pdf":[".pdf"]},multiple:!0}):e.jsxs(e.Fragment,{children:[v==="list"&&e.jsxs("div",{className:"space-y-3",children:[k.map((t,a)=>e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-xl bg-gray-50 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ne,{className:"w-5 h-5 text-red-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:t.name}),e.jsxs("span",{className:"text-xs text-gray-400",children:["(",(t.size/1024/1024).toFixed(2)," MB)"]})]}),e.jsx("button",{onClick:()=>se(a),className:"p-1.5 hover:bg-gray-200 rounded-full text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(ve,{className:"w-4 h-4"})})]},`${t.name}-${a}`)),e.jsx("div",{className:"mt-6",children:e.jsx(H,{onFilesSelected:F,accept:{"application/pdf":[".pdf"]},multiple:!0,className:"py-8"})})]}),v==="grid"&&e.jsxs(fe,{sensors:te,collisionDetection:he,onDragEnd:re,onDragStart:t=>G(t.active.id),children:[e.jsx(xe,{items:m.map(t=>t.id),strategy:ye,children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4",children:[m.map(t=>e.jsx(me,{...t,onRemove:ae},t.id)),e.jsxs("div",{className:"aspect-3/4 flex items-center justify-center bg-gray-50 border-2 border-dashed border-gray-200 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",onClick:()=>document.getElementById("add-more-pdf")?.click(),children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-2",children:e.jsx("span",{className:"text-xl",children:"+"})}),e.jsx("span",{className:"text-xs text-gray-500 font-medium",children:"Add More"})]}),e.jsx("input",{id:"add-more-pdf",type:"file",multiple:!0,accept:".pdf",className:"hidden",onChange:t=>{t.target.files&&F(Array.from(t.target.files))}})]})]})}),e.jsx(we,{children:T?e.jsx("div",{className:"aspect-3/4 bg-white rounded-lg shadow-xl overflow-hidden opacity-90 cursor-grabbing border-2 border-blue-500",children:e.jsx("img",{src:m.find(t=>t.id===T)?.image,className:"w-full h-full object-contain p-2"})}):null})]})]})}),P&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 text-red-600 rounded-full flex items-center justify-center",children:e.jsx(Pe,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Password Required"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["File: ",P.fileName]})]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"This PDF is password protected. Please enter the password to continue merging."}),e.jsx("input",{type:"password",value:z,onChange:t=>M(t.target.value),onKeyDown:t=>t.key==="Enter"&&!x&&O(),placeholder:"Enter password (or leave empty)",className:"w-full px-4 py-3 rounded-lg border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all",autoFocus:!0,disabled:x}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",id:"force-unlock-merge",checked:C,onChange:t=>E(t.target.checked),className:"mt-1 w-4 h-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500",disabled:x}),e.jsxs("label",{htmlFor:"force-unlock-merge",className:"text-sm text-gray-700 cursor-pointer",children:[e.jsx("span",{className:"font-semibold block text-gray-900",children:"Force Unlock (Flatten PDF)"}),e.jsx("span",{className:"text-gray-500",children:"Enable if password doesn't work. Converts pages to images (high quality)."})]})]}),x&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[e.jsx("span",{children:"Unlocking PDF..."}),e.jsxs("span",{className:"font-medium",children:[V,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"bg-blue-600 h-full transition-all duration-300",style:{width:`${V}%`}})})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{onClick:O,disabled:x,className:"w-full px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:x?"Processing...":"Submit"})}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:C?"Force Unlock will flatten the PDF by rendering pages as high-quality images.":`Tip: Check "Force Unlock" if you don't know the password or standard unlock fails.`})]})}),e.jsxs(ie,{onClick:le,disabled:L||m.length<1,isProcessing:L,processingMessage:Z,progress:Y,icon:De,children:["Merge ",m.length," Pages"]})]})}export{Ze as default};
