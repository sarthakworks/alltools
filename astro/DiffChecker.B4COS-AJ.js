import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as P}from"./index.BR1w_nJd.js";import"./i18n.YCqrvHGp.js";import{u as F,C as G}from"./useCopyToClipboard.CpkCSi__.js";import{u as H}from"./useTranslation.C-NthtKk.js";import{G as W}from"./git-compare.HuM2CPE2.js";import{T as J}from"./trash-2.CDySnx-i.js";import{A as K}from"./arrow-right-left.BNv3IpPw.js";import{R as Q}from"./rotate-ccw.3wE7q0Bs.js";import{C as B}from"./check.DST6BrT9.js";import{A as U}from"./arrow-right.CjLN0sOZ.js";import"./_commonjsHelpers.D6-XlEtG.js";import"./createLucideIcon._FvKnKwF.js";class X{diff(t,r,n={}){let o;typeof n=="function"?(o=n,n={}):"callback"in n&&(o=n.callback);const i=this.castInput(t,n),f=this.castInput(r,n),u=this.removeEmpty(this.tokenize(i,n)),d=this.removeEmpty(this.tokenize(f,n));return this.diffWithOptionsObj(u,d,n,o)}diffWithOptionsObj(t,r,n,o){var i;const f=c=>{if(c=this.postProcess(c,n),o){setTimeout(function(){o(c)},0);return}else return c},u=r.length,d=t.length;let m=1,l=u+d;n.maxEditLength!=null&&(l=Math.min(l,n.maxEditLength));const j=(i=n.timeout)!==null&&i!==void 0?i:1/0,v=Date.now()+j,p=[{oldPos:-1,lastComponent:void 0}];let b=this.extractCommon(p[0],r,t,0,n);if(p[0].oldPos+1>=d&&b+1>=u)return f(this.buildValues(p[0].lastComponent,r,t));let I=-1/0,S=1/0;const R=()=>{for(let c=Math.max(I,-m);c<=Math.min(S,m);c+=2){let y;const C=p[c-1],N=p[c+1];C&&(p[c-1]=void 0);let s=!1;if(N){const x=N.oldPos-c;s=N&&0<=x&&x<u}const h=C&&C.oldPos+1<d;if(!s&&!h){p[c]=void 0;continue}if(!h||s&&C.oldPos<N.oldPos?y=this.addToPath(N,!0,!1,0,n):y=this.addToPath(C,!1,!0,1,n),b=this.extractCommon(y,r,t,c,n),y.oldPos+1>=d&&b+1>=u)return f(this.buildValues(y.lastComponent,r,t))||!0;p[c]=y,y.oldPos+1>=d&&(S=Math.min(S,c-1)),b+1>=u&&(I=Math.max(I,c+1))}m++};if(o)(function c(){setTimeout(function(){if(m>l||Date.now()>v)return o(void 0);R()||c()},0)})();else for(;m<=l&&Date.now()<=v;){const c=R();if(c)return c}}addToPath(t,r,n,o,i){const f=t.lastComponent;return f&&!i.oneChangePerToken&&f.added===r&&f.removed===n?{oldPos:t.oldPos+o,lastComponent:{count:f.count+1,added:r,removed:n,previousComponent:f.previousComponent}}:{oldPos:t.oldPos+o,lastComponent:{count:1,added:r,removed:n,previousComponent:f}}}extractCommon(t,r,n,o,i){const f=r.length,u=n.length;let d=t.oldPos,m=d-o,l=0;for(;m+1<f&&d+1<u&&this.equals(n[d+1],r[m+1],i);)m++,d++,l++,i.oneChangePerToken&&(t.lastComponent={count:1,previousComponent:t.lastComponent,added:!1,removed:!1});return l&&!i.oneChangePerToken&&(t.lastComponent={count:l,previousComponent:t.lastComponent,added:!1,removed:!1}),t.oldPos=d,m}equals(t,r,n){return n.comparator?n.comparator(t,r):t===r||!!n.ignoreCase&&t.toLowerCase()===r.toLowerCase()}removeEmpty(t){const r=[];for(let n=0;n<t.length;n++)t[n]&&r.push(t[n]);return r}castInput(t,r){return t}tokenize(t,r){return Array.from(t)}join(t){return t.join("")}postProcess(t,r){return t}get useLongestToken(){return!1}buildValues(t,r,n){const o=[];let i;for(;t;)o.push(t),i=t.previousComponent,delete t.previousComponent,t=i;o.reverse();const f=o.length;let u=0,d=0,m=0;for(;u<f;u++){const l=o[u];if(l.removed)l.value=this.join(n.slice(m,m+l.count)),m+=l.count;else{if(!l.added&&this.useLongestToken){let j=r.slice(d,d+l.count);j=j.map(function(v,p){const b=n[m+p];return b.length>v.length?b:v}),l.value=this.join(j)}else l.value=this.join(r.slice(d,d+l.count));d+=l.count,l.added||(m+=l.count)}}return o}}class Y extends X{constructor(){super(...arguments),this.tokenize=te}equals(t,r,n){return n.ignoreWhitespace?((!n.newlineIsToken||!t.includes(`
`))&&(t=t.trim()),(!n.newlineIsToken||!r.includes(`
`))&&(r=r.trim())):n.ignoreNewlineAtEof&&!n.newlineIsToken&&(t.endsWith(`
`)&&(t=t.slice(0,-1)),r.endsWith(`
`)&&(r=r.slice(0,-1))),super.equals(t,r,n)}}const Z=new Y;function ee(a,t,r){return Z.diff(a,t,r)}function te(a,t){t.stripTrailingCr&&(a=a.replace(/\r\n/g,`
`));const r=[],n=a.split(/(\n|\r\n)/);n[n.length-1]||n.pop();for(let o=0;o<n.length;o++){const i=n[o];o%2&&!t.newlineIsToken?r[r.length-1]+=i:r.push(i)}return r}function ge(){const{t:a}=H(),[t,r]=P.useState(""),[n,o]=P.useState(""),[i,f]=P.useState([]),[u,d]=P.useState({additions:0,removals:0}),[m,l]=P.useState({}),{copiedId:j,handleCopy:v}=F(),p=(s,h)=>{if(!s&&!h){f([]),d({additions:0,removals:0}),l({});return}const x=ee(s,h),g=[];let E=1,A=1,D=0,T=0;for(let w=0;w<x.length;w++){const L=x[w],$=L.value.replace(/\n$/,"").split(`
`);if(L.added){D+=L.count||0;let k=0;for(let _=g.length-1;_>=0&&(g[_].rightType==="empty"&&g[_].leftType==="removed");_--)k++;let M=g.length-k;const V=g.length;$.forEach(_=>{M<V?(g[M].rightContent=_,g[M].rightType="added",g[M].rightLineNumber=A++,M++):g.push({leftLineNumber:null,leftContent:null,leftType:"empty",rightLineNumber:A++,rightContent:_,rightType:"added"})})}else L.removed?(T+=L.count||0,$.forEach(k=>{g.push({leftLineNumber:E++,leftContent:k,leftType:"removed",rightLineNumber:null,rightContent:null,rightType:"empty"})})):$.forEach(k=>{g.push({leftLineNumber:E++,leftContent:k,leftType:"unchanged",rightLineNumber:A++,rightContent:k,rightType:"unchanged"})})}let O=0,z=!1;const q=g.map(w=>w.leftType!=="unchanged"||w.rightType!=="unchanged"?(z||(O++,z=!0),{...w,blockId:`block-${O}`}):(z=!1,w));f(q),d({additions:D,removals:T}),l({})},b=()=>{p(t,n)},I=()=>{const s=n,h=t;r(s),o(h),p(s,h)},S=()=>{r(""),o(""),f([]),d({additions:0,removals:0}),l({})},R=()=>{r(`function add(a, b) {
  return a + b;
}
console.log(add(1, 2));`),o(`function add(a, b) {
  // Adding validation
  if (typeof a !== 'number' || typeof b !== 'number') return 0;
  return a + b;
}
console.log(add(1, 2));`),f([]),l({})},c=s=>{l(h=>{const x=h[s]||"right";return{...h,[s]:x==="right"?"left":"right"}})},y=()=>{const s={};i.forEach(h=>h.blockId&&(s[h.blockId]="left")),l(s)},C=()=>{l({})},N=P.useMemo(()=>i.length===0?"":i.map(s=>(s.blockId&&m[s.blockId]||"right")==="right"?s.rightType==="empty"?null:s.rightContent:s.leftType==="empty"?null:s.leftContent).filter(s=>s!==null).join(`
`),[i,m]);return e.jsxs("div",{className:"max-w-[1600px] mx-auto p-4 sm:p-6 lg:p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(W,{className:"w-8 h-8 text-cyan-600"}),a("tools_ui.diff_checker.title")]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:S,className:"px-4 py-2 text-sm font-medium text-gray-600 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4"})," ",a("tools_ui.common.clear")]}),e.jsx("button",{onClick:R,className:"px-4 py-2 text-sm font-medium text-cyan-600 bg-cyan-50 rounded-lg hover:bg-cyan-100 flex items-center gap-2",children:a("tools_ui.common.load_sample")})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 h-[300px] mb-8 relative items-center",children:[e.jsxs("div",{className:"flex flex-col border border-gray-200 rounded-xl overflow-hidden bg-white shadow-sm flex-1 h-full w-full",children:[e.jsx("div",{className:"px-4 py-2 bg-gray-50 border-b border-gray-100 flex justify-between items-center",children:e.jsx("span",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider",children:a("tools_ui.diff_checker.original_label")})}),e.jsx("textarea",{className:"flex-grow p-4 outline-none resize-none font-mono text-xs leading-5 bg-white",value:t,onChange:s=>r(s.target.value),placeholder:a("tools_ui.diff_checker.original_placeholder"),spellCheck:!1})]}),e.jsx("button",{onClick:I,className:"p-2 bg-white border border-gray-200 rounded-full shadow-sm hover:bg-gray-50 hover:text-cyan-600 transition-colors z-10 md:absolute md:left-1/2 md:top-1/2 md:-translate-x-1/2 md:-translate-y-1/2",title:"Swap Inputs",children:e.jsx(K,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex flex-col border border-gray-200 rounded-xl overflow-hidden bg-white shadow-sm flex-1 h-full w-full",children:[e.jsx("div",{className:"px-4 py-2 bg-gray-50 border-b border-gray-100 flex justify-between items-center",children:e.jsx("span",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider",children:a("tools_ui.diff_checker.modified_label")})}),e.jsx("textarea",{className:"flex-grow p-4 outline-none resize-none font-mono text-xs leading-5 bg-white",value:n,onChange:s=>o(s.target.value),placeholder:a("tools_ui.diff_checker.modified_placeholder"),spellCheck:!1})]})]}),e.jsx("div",{className:"flex justify-center mb-8",children:e.jsxs("button",{onClick:b,className:"flex items-center gap-2 px-8 py-3 bg-cyan-600 text-white font-semibold rounded-xl hover:bg-cyan-700 transition-colors shadow-lg shadow-cyan-600/20 text-lg",children:[e.jsx(W,{className:"w-5 h-5"})," ",a("tools_ui.diff_checker.find_diff")]})}),i.length>0&&e.jsxs("div",{className:"border border-gray-200 rounded-xl overflow-hidden bg-white shadow-sm mb-12",children:[e.jsxs("div",{className:"px-4 py-3 bg-gray-50 border-b border-gray-200 flex justify-between items-center flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-xs font-bold text-gray-700 uppercase tracking-wider",children:a("tools_ui.diff_checker.result_title")}),e.jsxs("div",{className:"flex gap-2",children:[u.removals>0&&e.jsxs("span",{className:"text-xs font-bold text-red-600 bg-red-50 px-2 py-0.5 rounded-full border border-red-100",children:["-",u.removals," removals"]}),u.additions>0&&e.jsxs("span",{className:"text-xs font-bold text-green-600 bg-green-50 px-2 py-0.5 rounded-full border border-green-100",children:["+",u.additions," additions"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-auto",children:[e.jsxs("button",{onClick:y,className:"px-3 py-1.5 text-xs font-medium bg-white text-gray-700 border border-gray-200 rounded-md hover:bg-gray-50 hover:border-gray-300 transition-colors flex items-center gap-1.5 shadow-sm",children:[e.jsx(Q,{className:"w-3.5 h-3.5"})," ",a("tools_ui.diff_checker.revert_all")]}),e.jsxs("button",{onClick:C,className:"px-3 py-1.5 text-xs font-medium bg-white text-gray-700 border border-gray-200 rounded-md hover:bg-gray-50 hover:border-gray-300 transition-colors flex items-center gap-1.5 shadow-sm",children:[e.jsx(B,{className:"w-3.5 h-3.5"})," ",a("tools_ui.diff_checker.accept_all")]}),e.jsx("div",{className:"h-6 w-px bg-gray-300 mx-2"}),e.jsx("button",{onClick:()=>v(N,"merged-output"),className:"px-4 py-1.5 text-xs font-bold bg-cyan-600 text-white rounded-md hover:bg-cyan-700 flex items-center gap-1.5 shadow-sm shadow-cyan-600/20",children:j==="merged-output"?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"w-3.5 h-3.5"})," ",a("tools_ui.common.copied")]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"w-3.5 h-3.5"})," ",a("tools_ui.diff_checker.copy_merged")]})})]})]}),e.jsx("div",{className:"font-mono text-xs leading-5 overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsxs("colgroup",{children:[e.jsx("col",{width:"40px"}),e.jsx("col",{width:"50%"}),e.jsx("col",{width:"50px"}),e.jsx("col",{width:"40px"}),e.jsx("col",{width:"50%"})]}),e.jsx("tbody",{children:i.map((s,h)=>{const x=s.blockId,g=x&&m[x]||"right",E=s.leftType!=="unchanged"||s.rightType!=="unchanged",A=x&&(h===0||i[h-1].blockId!==x);let D=s.rightContent,T=s.rightType;return g==="left"&&E&&(D=s.leftContent,T=s.leftType==="removed"?"removed":"unchanged"),e.jsxs("tr",{className:"border-b border-gray-50 last:border-0 hover:bg-gray-50/50 group",children:[e.jsx("td",{className:`text-right pr-3 select-none text-gray-400 border-r border-gray-100 ${s.leftType==="removed"?"bg-red-50":"bg-white"}`,children:s.leftLineNumber}),e.jsx("td",{className:`pl-2 pr-2 whitespace-pre-wrap break-all ${s.leftType==="removed"?"bg-red-50 text-red-900":"text-gray-600"} ${g==="right"&&E?"opacity-60":""}`,children:s.leftContent||" "}),e.jsx("td",{className:"text-center bg-gray-50/30 border-l border-r border-gray-100 p-0 align-middle",children:A&&e.jsx("button",{onClick:()=>x&&c(x),className:`w-6 h-6 rounded-full flex items-center justify-center transition-all shadow-sm mx-auto ${g==="left"?"bg-green-600 text-white ring-2 ring-green-100 scale-110":"bg-white border border-gray-200 text-gray-400 hover:text-green-600 hover:border-green-300"}`,title:a(g==="left"?"tools_ui.diff_checker.status_reverted":"tools_ui.diff_checker.status_modified"),children:e.jsx(U,{className:"w-3.5 h-3.5"})})}),e.jsx("td",{className:`text-right pr-3 select-none text-gray-400 border-r border-gray-100 ${T==="added"?"bg-green-50":"bg-white"}`,children:s.rightLineNumber}),e.jsx("td",{className:`pl-2 pr-2 whitespace-pre-wrap break-all ${T==="added"?"bg-green-50 text-green-900":"text-gray-600"}`,children:D||" "})]},h)})})]})})]})]})}export{ge as default};
