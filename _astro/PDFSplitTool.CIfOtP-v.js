import{_ as T}from"./preload-helper.CJ8dg2r8.js";import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as y}from"./index.BR1w_nJd.js";import{P as v}from"./PDFButton.Bm7otZl6.js";import{J as z}from"./jszip.min.CL8lVgXJ.js";import{F as L}from"./fileUploader.D55Ta1Pr.js";import{F as k}from"./FileSaver.min.D-v3scGK.js";import{u as R,a as E,D as G,c as O,S as U,r as K,b as M,s as q,K as J,P as V,d as Z,e as W,C as X}from"./sortable.esm.B22XIUkC.js";import{S as H}from"./scissors.zT-dhgPn.js";import{L as $}from"./loader-circle.m7cZJHvs.js";import{F as Q}from"./file-text.DcW9pNJ8.js";import{G as Y}from"./grid-3x3.s6Fv8het.js";import{X as ee}from"./x.DlPzfmHM.js";import"./_commonjsHelpers.D6-XlEtG.js";import"./_commonjs-dynamic-modules.TDtrdbi3.js";import"./index.BUxk5OiF.js";import"./createLucideIcon._FvKnKwF.js";import"./utils.fNskMoFt.js";import"./index.B80MxM07.js";function te({id:i,image:j,fileName:r,pageIndex:p,onRemove:m}){const{attributes:d,listeners:u,setNodeRef:x,transform:P,transition:S,isDragging:h}=W({id:i}),D={transform:X.Transform.toString(P),transition:S,zIndex:h?10:1,opacity:h?.5:1};return e.jsxs("div",{ref:x,style:D,...d,...u,className:"group relative aspect-3/4 bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-shadow cursor-grab active:cursor-grabbing",children:[e.jsx("img",{src:j,alt:`Page ${p+1}`,className:"w-full h-full object-contain p-2"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/5 transition-colors"}),e.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("button",{onPointerDown:N=>{N.stopPropagation(),m(i)},className:"p-1 bg-red-500 text-white rounded-full hover:bg-red-600 shadow-sm",children:e.jsx(ee,{className:"w-3 h-3"})})}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-white/90 backdrop-blur-sm p-2 text-xs text-gray-600 border-t border-gray-100 truncate",children:[r," - P",p+1]})]})}function ve(){const[i,j]=y.useState([]),[r,p]=y.useState([]),[m,d]=y.useState(!1),[u,x]=y.useState(null),P=R(E(V),E(J,{coordinateGetter:q})),S=async t=>{d(!0);const l=[...i,...t];j(l);const o=[];let c=i.length;try{const a=await T(()=>import("./pdf.OfKI3oAY.js"),[]);a.GlobalWorkerOptions.workerSrc="/pdf.worker.min.mjs";for(let s=0;s<t.length;s++){const n=t[s],g=await n.arrayBuffer(),w=await a.getDocument({data:g}).promise;for(let f=1;f<=w.numPages;f++){const C=await w.getPage(f),I=C.getViewport({scale:.5}),b=document.createElement("canvas"),_=b.getContext("2d");b.height=I.height,b.width=I.width,_&&(await C.render({canvasContext:_,viewport:I}).promise,o.push({id:`f${c+s}-p${f}-${Date.now()}-${Math.random()}`,fileIndex:c+s,pageIndex:f-1,image:b.toDataURL(),fileName:n.name}))}}}catch(a){console.error("Error processing PDF:",a),alert(`Failed to load PDF: ${a?.message||"Unknown error"}.`)}p(a=>[...a,...o]),d(!1)},h=t=>{p(l=>l.filter(o=>o.id!==t))},D=t=>{const{active:l,over:o}=t;l.id!==o.id&&p(c=>{const a=c.findIndex(n=>n.id===l.id),s=c.findIndex(n=>n.id===o.id);return Z(c,a,s)}),x(null)},N=t=>{x(t.active.id)},B=async()=>{if(r.length!==0){d(!0);try{const t=await v.create(),l=[...new Set(r.map(s=>s.fileIndex))],o={};for(const s of l){const n=await i[s].arrayBuffer();o[s]=await v.load(n)}for(const s of r){const n=o[s.fileIndex],[g]=await t.copyPages(n,[s.pageIndex]);t.addPage(g)}const c=await t.save(),a=new Blob([c],{type:"application/pdf"});k.saveAs(a,`splitted-rearranged-${Date.now()}.pdf`)}catch(t){console.error(t),alert("Error saving PDF")}finally{d(!1)}}},A=async()=>{if(r.length!==0){d(!0);try{const t=new z,l=[...new Set(r.map(a=>a.fileIndex))],o={};for(const a of l){const s=await i[a].arrayBuffer();o[a]=await v.load(s)}for(let a=0;a<r.length;a++){const s=r[a],n=o[s.fileIndex],g=await v.create(),[F]=await g.copyPages(n,[s.pageIndex]);g.addPage(F);const w=await g.save();t.file(`Page_${a+1}_${s.fileName}`,w)}const c=await t.generateAsync({type:"blob"});k.saveAs(c,`extracted_pages_${Date.now()}.zip`)}catch(t){console.error(t),alert("Error extracting pages")}finally{d(!1)}}};return e.jsxs("div",{className:"space-y-8",children:[i.length>0&&e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4 p-4 bg-gray-50 rounded-xl border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Split & Organize Mode"})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[r.length," pages selected"]})]}),e.jsx("div",{className:"min-h-75",children:i.length===0?e.jsx(L,{onFilesSelected:S,accept:{"application/pdf":[".pdf"]},multiple:!0,title:"Upload PDF to Split"}):e.jsx("div",{className:"space-y-6",children:e.jsxs(G,{sensors:P,collisionDetection:O,onDragEnd:D,onDragStart:N,children:[e.jsx(U,{items:r.map(t=>t.id),strategy:K,children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4",children:r.map(t=>e.jsx(te,{...t,onRemove:h},t.id))})}),e.jsx(M,{children:u?e.jsx("div",{className:"aspect-3/4 bg-white rounded-lg shadow-xl overflow-hidden opacity-90 cursor-grabbing border-2 border-blue-500",children:e.jsx("img",{src:r.find(t=>t.id===u)?.image,className:"w-full h-full object-contain p-2"})}):null})]})})}),i.length>0&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:B,disabled:m,className:"w-full py-4 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-bold text-lg shadow-lg shadow-blue-500/20 flex items-center justify-center gap-2 transition-all",children:[m?e.jsx($,{className:"animate-spin w-5 h-5"}):e.jsx(Q,{className:"w-5 h-5"}),"Save as Single PDF"]}),e.jsxs("button",{onClick:A,disabled:m,className:"w-full py-4 bg-purple-600 hover:bg-purple-700 text-white rounded-xl font-bold text-lg shadow-lg shadow-purple-500/20 flex items-center justify-center gap-2 transition-all",children:[m?e.jsx($,{className:"animate-spin w-5 h-5"}):e.jsx(Y,{className:"w-5 h-5"}),"Extract All as ZIP"]})]})]})}export{ve as default};
